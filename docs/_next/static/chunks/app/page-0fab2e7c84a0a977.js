(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3281:function(){},1805:function(){},7277:function(e,t,l){Promise.resolve().then(l.bind(l,4371))},4371:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return U}});var a=l(5777),o=l(7017),r=l(628),n=l(2133),s=l(7336),i=l(2891),c=l(5945),d=l(7510),f=l(774);function u(e){let{show:t}=e;return(0,a.jsx)("div",{className:"w-screen h-screen fixed backdrop-blur-sm z-10 flex flex-col items-center justify-center ".concat(t?"block":"hidden"),children:(0,a.jsxs)("div",{className:"w-96 p-4 space-y-2 rounded-md shadow-md ".concat((0,f.ff)("bg-white","bg-gray-900")),children:[(0,a.jsx)("h1",{className:"font-bold text-lg",children:"Drag & Drop an SVG to Upload"}),(0,a.jsx)("p",{children:"Drop a compatible SVG anywhere to begin separating its colors."})]})})}var h=l(3029),p=l(1295),m=l(5744),x=l(6951);function g(e){let{color:t,name:l,active:o,toggleColor:r}=e,n=(0,c.useCallback)(()=>r(t),[t,r]);return(0,a.jsx)(p.u,{label:l,children:(0,a.jsx)("button",{className:"rounded-full bg-transparent transition-all m-1 focus:outline hover:scale-110",style:{width:"2rem",height:"2rem",borderWidth:o?"0.2rem":"1rem",borderColor:t,outlineColor:t},onClick:n})})}function b(e){let{colors:t,toggleColor:l}=e,o=[...t].map(e=>{let[t,[o,r]]=e;return(0,a.jsx)(g,{color:t,name:o,toggleColor:l,active:r},t)});return(0,a.jsx)("div",{className:"flex flex-wrap justify-center",children:o})}var w=l(1584),j=l(1122),y=l(7216),v=l(8572);let C=[["#f15060","bright red"],["#ff48b0","fluorescent pink"],["#ffe800","yellow"],["#00a95c","green"],["#0078bf","blue"],["#000000","black"]],S=[["#00ffff","cyan"],["#ff00ff","magenta"],["#ffff00","yellow"],["#000000","black"]];function k(e){let{colors:t,setPallette:l,addColor:o}=e;(0,c.useEffect)(()=>l(C),[l]);let[r,n]=(0,c.useState)(""),s=(0,c.useCallback)(e=>n(e.target.value),[n]),[i,d]=(0,c.useState)("#000000"),f=(0,c.useCallback)(e=>d(e.target.value),[d]),u=(0,c.useCallback)(()=>o(i,r),[i,r,o]),m=r&&!t.has(i),x=r?t.has(i)?"can only add unique colors":void 0:"must name added colors";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(w.B,{children:[(0,a.jsx)(j.I,{placeholder:"Color Name",value:r,onChange:s}),(0,a.jsx)(j.I,{type:"color",style:{borderRadius:0,borderLeft:0,width:"8rem"},value:i,onChange:f}),(0,a.jsx)(y.xW,{style:{padding:0},children:(0,a.jsx)(p.u,{label:x,children:(0,a.jsx)(h.z,{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isDisabled:!m,onClick:u,children:"Add"})})})]}),(0,a.jsxs)(v.P,{placeholder:"Select Pallette",onChange:e=>{let t=e.target.value;"none"===t?l([]):"riso"===t?l(C):"cmyk"===t&&l(S)},children:[(0,a.jsx)("option",{value:"none",children:"None"}),(0,a.jsx)("option",{value:"riso",children:"Risograph"}),(0,a.jsx)("option",{value:"cmyk",children:"CMYK"})]})]})}function N(e){let{children:t}=e;return(0,a.jsx)("h2",{className:"font-bold text-lg",children:t})}function M(e){let{colors:t,modifyColors:l,increments:o,setIncrements:r,download:n,showRaw:s,setShowRaw:i}=e,d=t.size?void 0:"must select at least one color to export",f=(0,c.useCallback)(()=>i(!0),[i]),u=(0,c.useCallback)(()=>i(!1),[i]),g=(0,c.useCallback)(e=>l({action:"toggle",color:e}),[l]),w=(0,c.useCallback)(e=>l({action:"set",colors:e}),[l]),j=(0,c.useCallback)((e,t)=>l({action:"add",color:e,name:t}),[l]),y=[...t.values()].some(e=>{let[,t]=e;return t});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.z,{className:"w-full",isDisabled:!y,onMouseDown:f,onMouseUp:u,children:"Toggle Original"}),(0,a.jsx)(p.u,{label:d,children:(0,a.jsx)(h.z,{className:"w-full",isDisabled:!y,onClick:n,leftIcon:(0,a.jsx)(x.ZJh,{}),children:"Export Separation"})}),(0,a.jsx)(N,{children:"Colors"}),(0,a.jsx)("p",{children:"Click a color to toggle its use in the separation"}),(0,a.jsx)(b,{colors:t,toggleColor:g}),(0,a.jsx)(N,{children:"Pallette"}),(0,a.jsx)("p",{children:"Add new colors or reset to a pallette"}),(0,a.jsx)(k,{setPallette:w,colors:t,addColor:j}),(0,a.jsx)(N,{children:"Dicretizations"}),(0,a.jsx)("p",{children:"Drag the slider to change the number of dicrete opacities, this produces a more posterized appearance."}),(0,a.jsx)("div",{className:"px-4",children:(0,a.jsxs)(m.iR,{defaultValue:o,onChange:r,min:0,max:7,step:1,children:[(0,a.jsx)(m.Uj,{children:(0,a.jsx)(m.Ms,{})}),(0,a.jsx)(m.gs,{})]})})]})}var P=l(8905);function E(e){let{helpDisabled:t,toggleHelp:l}=e;return(0,a.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,a.jsx)(p.u,{label:"show help",children:(0,a.jsx)(P.h,{"aria-label":"show help information",icon:(0,a.jsx)(x.DAO,{}),isDisabled:t,onClick:l})}),(0,a.jsx)("a",{href:"https://github.com/hafaio/color-separation",target:"_blank",rel:"noreferrer",children:(0,a.jsx)(P.h,{"aria-label":"view source on github",icon:(0,a.jsx)(x.hJX,{})})})]})}function D(e){let{closeable:t}=e,l=t?(0,a.jsx)("p",{className:"pt-4 pb-4",children:"Click the info button below to hide this information."}):null;return(0,a.jsxs)("div",{className:"flex flex-col justify-between flex-grow",children:[(0,a.jsxs)("div",{className:"space-y-1 flex-grow",children:[(0,a.jsx)("p",{children:"Separate an SVG into spot colors; useful for risograph printing. Currently this assumes a naive subtractive color model, that works reasonably, but could probably be improved."}),(0,a.jsxs)("ol",{className:"list-decimal ml-4",children:[(0,a.jsx)("li",{children:"Upload your SVG by clicking above or dropping it anywhere."}),(0,a.jsx)("li",{children:"Customize your color pallette by adding colors available."}),(0,a.jsx)("li",{children:"Select different colors and losses to check our your decomposition."}),(0,a.jsx)("li",{children:"Click export to download an individual SVG for each layer."})]})]}),l]})}var G=l(2065),R=l(7865),V=l(6406);l(3902);let I=(0,G.B1)({config:{initialColorMode:"system",useSystemColorMode:!0}},(0,R.A)({colorScheme:"gray"}));function z(e){let{children:t}=e;return(0,a.jsx)(V.x,{theme:I,children:t})}function A(e){let{onFile:t,loading:l=!1}=e,o=(0,c.useRef)(null);return(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{ref:o,type:"file",accept:"image/svg+xml, image/png, image/jpeg",onChange:e=>{var l;let a=null===(l=e.target.files)||void 0===l?void 0:l[0];a&&t(a)},className:"hidden"}),(0,a.jsx)(h.z,{className:"w-full",isLoading:l,onClick:()=>{var e;null===(e=o.current)||void 0===e||e.click()},leftIcon:(0,a.jsx)(x.Gq2,{}),children:"Upload"})]})}function B(e){let t=new FileReader;return new Promise(l=>{t.addEventListener("load",()=>l(t.result)),t.readAsDataURL(e)})}async function O(e){let t=await createImageBitmap(e),l=new OffscreenCanvas(t.width,t.height),a=l.getContext("2d");return a.drawImage(t,0,0),a.getImageData(0,0,t.width,t.height,{colorSpace:"srgb"})}async function _(e){let t=await createImageBitmap(e),l=new OffscreenCanvas(t.width,t.height);return l.getContext("bitmaprenderer").transferFromImageBitmap(t),await l.convertToBlob()}let Z=["fill","stroke","stopColor"];async function*F(e){let t=await fetch(e),l=await t.blob();if("image/png"===l.type||"image/jpeg"===l.type){let e=await O(l),t=e.width*e.height*4;for(let l=0;l<t;l+=4)yield r.B8(e.data[l],e.data[l+1],e.data[l+2])}else if("image/svg+xml"===l.type){let e=await l.text(),t=new DOMParser,i=t.parseFromString(e,l.type);for(let e of i.querySelectorAll("*")){var a,o,n,s;if(e instanceof SVGStyleElement){for(let t of null!==(o=null===(a=e.sheet)||void 0===a?void 0:a.cssRules)&&void 0!==o?o:[])if(t instanceof CSSStyleRule)for(let e of Z){let l=r.ZP(null===(n=t.style)||void 0===n?void 0:n[e]);l&&(yield l)}}else if(e instanceof SVGImageElement)for await(let t of F(e.href.baseVal))yield t;else if(e instanceof SVGElement)for(let t of Z){let l=r.ZP(null===(s=e.style)||void 0===s?void 0:s[t]);l&&(yield l)}}}else throw Error("unhandled url type: ".concat(l.type))}async function L(e,t){let l=await fetch(e),a=await l.blob();if("image/png"===a.type||"image/jpeg"===a.type){let e=await O(a),l=e.width*e.height*4;for(let a=0;a<l;a+=4){let l=r.B8(e.data[a],e.data[a+1],e.data[a+2]),{r:o,g:n,b:s}=t(l).rgb();e.data[a]=o,e.data[a+1]=n,e.data[a+2]=s}return await _(e)}if("image/svg+xml"===a.type){let e=await a.text(),l=new DOMParser,i=l.parseFromString(e,a.type),c=[];for(let e of i.querySelectorAll("*"))if(e instanceof SVGStyleElement){var o,n,s;let l=[...null!==(n=null===(o=e.sheet)||void 0===o?void 0:o.cssRules)&&void 0!==n?n:[]];for(let e of l)if(e instanceof CSSStyleRule)for(let l of Z){let a=r.ZP(null===(s=e.style)||void 0===s?void 0:s[l]);a&&(e.style[l]=t(a).toString())}e.textContent=l.map(e=>e.cssText).join("\n")}else if(e instanceof SVGImageElement)c.push((async()=>{let l=await L(e.href.baseVal,t),a=await B(l);e.setAttribute("href",a)})());else if(e instanceof SVGElement)for(let l of Z){let a=r.ZP(e.style[l]);a&&(e.style[l]=t(a).toString())}await Promise.all(c);let d=new XMLSerializer,f=d.serializeToString(i);return new Blob([f],{type:"image/svg+xml"})}throw Error("unhandled url type: ".concat(a.type))}var T=l(2213);function U(){let[e,t]=(0,c.useState)(!1),[l,f]=(0,c.useState)(!1),h=(0,c.useCallback)(()=>f(!l),[l,f]),p=(0,o.p)(),[m,x]=(0,c.useState)(),[g,b]=(0,c.useState)(),[w,j]=(0,c.useState)(),[y,v]=(0,c.useReducer)((e,t)=>{if("set"===t.action)return new Map(t.colors.map(e=>{let[t,l]=e;return[t,[l,!1]]}));if("add"===t.action){let l=new Map(e);return l.set(t.color,[t.name,!1]),l}{let l=new Map(e),[a,o]=l.get(t.color);return l.set(t.color,[a,!o]),l}},new Map),[[C,S],k]=(0,c.useState)([void 0,new Map]),[N,P]=(0,c.useState)(0);(0,c.useEffect)(()=>{g&&!w&&(async()=>{let e=new Set;for await(let t of F(g))e.add(t.formatHex());j([...e])})()},[j,g,w]),(0,c.useEffect)(()=>{if(g&&w&&[...y.values()].some(e=>{let[,t]=e;return t})){let e=[];for(let[t,[,l]]of y)l&&e.push(t);let t=new Map,l=new Map;for(let a of w){let{opacities:o,color:s}=function(e,t){var l;let{increments:a=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.ZP(e).rgb(),s=t.map(e=>r.ZP(e).rgb()),i=Math.max(a,1),c=s.map(e=>{let{r:t,g:l,b:a}=e;return 1e-7*(t+l+a)}),d={},f={},u={};for(let[e,t]of c.entries()){let l="mx ".concat(e);d[l]={max:i},f["mix ".concat(e)]={error:t,[l]:1}}for(let e of["r","g","b"]){let t=255-o[e],l="up ".concat(e);d[l]={max:t};let a="dn ".concat(e);d[a]={min:t};let r="slack ".concat(e);for(let[t,o]of(f[r]={error:1,[l]:-1,[a]:1},s.entries())){let r=255-o[e],n="mix ".concat(t);f[n][l]=r/i,f[n][a]=r/i}}if(a>0)for(let[e]of c.entries())u["mix ".concat(e)]=1;let{result:h,feasible:p,bounded:m,...x}=T.Solve.call({},{optimize:"error",opType:"min",constraints:d,variables:f,ints:u});if(!p||!m)throw Error("couldn't find bounded feasible solution");let g=s.map((e,t)=>Math.min((null!==(l=x["mix ".concat(t)])&&void 0!==l?l:0)/i,1)),b=g.reduce((e,t,l)=>e+c[l]*t,0),w=g.reduce((e,t)=>e+t,0),j=n.MA(100*(1-w)).rgb();for(let[e,t]of s.entries()){let l=g[e];for(let e of["r","g","b"])j[e]+=t[e]*l}return{error:(h-b)/765,opacities:g,color:j.formatHex()}}(a,e,{increments:N});t.set(a,o),l.set(a,s)}let a=e=>{let t=r.ZP(l.get(e.formatHex()));return t.copy({opacity:e.opacity})};(async()=>{let e=await L(g,a),l=await B(e);k([l,t])})()}else k([void 0,new Map])},[y,N,g,w,k]);let G=(0,c.useCallback)(async()=>{if(g&&S.size&&m){let e=m.slice(0,m.lastIndexOf("."))||m,t=[];for(let[e,l]of y.values())l&&t.push(e);let l=[];for(let[a,o]of t.entries()){let t=e=>{let t=S.get(e.formatHex())[a],l=n.MA((1-t)*100);return l.copy({opacity:e.opacity})};l.push(L(g,t).then(t=>{let l=(0,i.extension)(t.type);(0,s.saveAs)(t,"".concat(e,"_").concat(o.replace(" ","_"),".").concat(l))}))}await Promise.all(l)}},[g,S,y,m]),R=(0,c.useCallback)(async e=>{x(e.name),b(null),j(null),f(!1);try{let t=await B(e);b(t)}catch(e){console.error(e),p({title:"Couldn't load file",status:"error",position:"bottom-left"}),b(void 0)}},[b,x,f,p]),V=g&&w&&!l?(0,a.jsx)(M,{colors:y,modifyColors:v,increments:N,setIncrements:P,download:G,showRaw:e,setShowRaw:t}):(0,a.jsx)(D,{closeable:!!g&&!!w}),I=e?g:null!=C?C:g,O=I?(0,a.jsx)("img",{src:I,alt:"rendered separation",className:"h-full w-full object-contain"}):null,_=(0,c.useCallback)((e,t)=>{let[l]=e;l&&R(l),t.length&&p({title:"Dropped file was not an SVG, PNG, or JPEG",status:"error",position:"bottom-left"})},[R,p]),{getRootProps:Z,getInputProps:U,isDragActive:H}=(0,d.uI)({onDrop:_,accept:{"image/svg+xml":[],"image/png":[],"image/jpeg":[]},multiple:!1,noClick:!0});return(0,a.jsx)(z,{children:(0,a.jsxs)("div",{...Z({className:"h-screen w-screen flex flex-row"}),children:[(0,a.jsx)("input",{...U()}),(0,a.jsx)(u,{show:H}),(0,a.jsxs)("div",{className:"w-72 h-full p-2 overflow-y-auto flex flex-col flex-shrink-0 justify-between",children:[(0,a.jsxs)("div",{className:"space-y-2 flex-grow flex flex-col",children:[(0,a.jsx)("h1",{className:"font-bold text-xl text-center",children:"Spot Color Separator"}),(0,a.jsx)(A,{onFile:R,loading:null===g}),V]}),(0,a.jsx)(E,{helpDisabled:!g,toggleHelp:h})]}),(0,a.jsx)("div",{className:"h-full w-full overflow-auto",children:O})]})})}},3902:function(){}},function(e){e.O(0,[139,435,986,670,744],function(){return e(e.s=7277)}),_N_E=e.O()}]);