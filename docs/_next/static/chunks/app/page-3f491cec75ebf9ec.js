(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8741:function(e,t,l){Promise.resolve().then(l.bind(l,7823))},7823:function(e,t,l){"use strict";l.d(t,{default:function(){return H}});var a=l(7437),o=l(610),r=l(4181),n=l(7170),s=l(6755),i=l(2265),c=l(2781);async function d(e){let t=await fetch(e);return await t.blob()}function u(e){let t=new FileReader;return new Promise(l=>{t.addEventListener("load",()=>{l(t.result)}),t.readAsDataURL(e)})}async function f(e,t,l){if("image/svg+xml"===e.type)return e;let a=await createImageBitmap(e);if(a.width<=t&&a.height<=l)return e;let o=a.width*l,r=a.height*t,[n,s]=o>r?[t,r/a.width]:[o/a.height,l],i=new OffscreenCanvas(n,s);return i.getContext("2d").drawImage(a,0,0,n,s),await i.convertToBlob()}var h=l(3969);async function*p(e,t,a){let o=new Set;for await(let t of e)o.add(t.formatHex());let n=new Uint8ClampedArray(3*t.length);for(let[e,l]of t.entries()){let{r:t,g:a,b:o}=l.rgb();n.set([t,a,o],3*e)}let s={colors:o,pool:n,increments:a},i=new Worker(l.tu(new URL(l.p+l.u(962),l.b))),c=await new Promise(e=>{i.addEventListener("message",t=>{e(t.data)}),i.postMessage(s,{transfer:[n.buffer]})});if("err"===c.typ)throw Error(c.err);let{prevs:d,opacs:u}=c,f=0;for(let e of o){let[l,a,o]=d.slice(3*f,(f+1)*3),n=[...u.slice(f*t.length,(f+1)*t.length)];yield[e,r.B8(l,a,o),n],f++}}let g=["fill","stroke","stopColor"];async function*m(e){if("image/png"===e.type||"image/jpeg"===e.type){let t=await createImageBitmap(e),l=new OffscreenCanvas(t.width,t.height).getContext("2d");l.drawImage(t,0,0);let{data:a}=l.getImageData(0,0,t.width,t.height,{colorSpace:"srgb"});for(let e=0;e<a.length;e+=4){let[t,l,o]=a.slice(e,e+3);yield r.B8(t,l,o)}}else if("image/svg+xml"===e.type){let n=await e.text();for(let s of new DOMParser().parseFromString(n,e.type).querySelectorAll("*")){var t,l,a,o;if(s instanceof SVGStyleElement){for(let e of null!==(l=null===(t=s.sheet)||void 0===t?void 0:t.cssRules)&&void 0!==l?l:[])if(e instanceof CSSStyleRule)for(let t of g){let l=r.ZP(null===(a=e.style)||void 0===a?void 0:a[t]);l&&(yield l)}}else if(s instanceof SVGImageElement)for await(let e of m(await d(s.href.baseVal)))yield e;else if(s instanceof SVGElement)for(let e of g){let t=r.ZP(null===(o=s.style)||void 0===o?void 0:o[e]);t&&(yield t)}}}else throw Error("unhandled url type: ".concat(e.type))}async function x(e,t){if("image/png"===e.type||"image/jpeg"===e.type){let l=await createImageBitmap(e),a=new OffscreenCanvas(l.width,l.height),o=a.getContext("2d");o.drawImage(l,0,0);let n=o.getImageData(0,0,l.width,l.height,{colorSpace:"srgb"});for(let e=0;e<n.data.length;e+=4){let[l,a,o]=n.data.slice(e,e+3),{r:s,g:i,b:c}=t(r.B8(l,a,o)).rgb();n.data.set([s,i,c],e)}return o.putImageData(n,0,0),await a.convertToBlob()}if("image/svg+xml"===e.type){let n=await e.text(),s=new DOMParser().parseFromString(n,e.type),i=[];for(let e of s.querySelectorAll("*"))if(e instanceof SVGStyleElement){var l,a,o;let n=[...null!==(a=null===(l=e.sheet)||void 0===l?void 0:l.cssRules)&&void 0!==a?a:[]];for(let e of n)if(e instanceof CSSStyleRule)for(let l of g){let a=r.ZP(null===(o=e.style)||void 0===o?void 0:o[l]);a&&(e.style[l]=t(a).toString())}e.textContent=n.map(e=>e.cssText).join("\n")}else if(e instanceof SVGImageElement)i.push((async()=>{let l=await d(e.href.baseVal),a=await x(l,t),o=await u(a);e.setAttribute("href",o)})());else if(e instanceof SVGElement)for(let l of g){let a=r.ZP(e.style[l]);a&&(e.style[l]=t(a).toString())}return await Promise.all(i),new Blob([new XMLSerializer().serializeToString(s)],{type:"image/svg+xml"})}throw Error("unhandled url type: ".concat(e.type))}async function w(e,t,l){let a=new Map;for await(let[o,r]of p(m(e),t,l))a.set(o,r);return await x(e,e=>a.get(e.formatHex()).copy({opacity:e.opacity}))}async function b(e,t,l){let a=new Map;for await(let[o,,r]of p(m(e),t,l))a.set(o,r);return await Promise.all(t.map((t,l)=>x(e,e=>{let t=a.get(e.formatHex())[l];return h.MA((1-t)*100).copy({opacity:e.opacity})})))}var y=l(3378);function v(e){let{show:t}=e;return(0,a.jsx)("div",{className:"w-screen h-screen fixed backdrop-blur-sm z-10 flex flex-col items-center justify-center ".concat(t?"block":"hidden"),children:(0,a.jsxs)("div",{className:"w-96 p-4 space-y-2 rounded-md shadow-md ".concat((0,y.ff)("bg-white","bg-gray-900")),children:[(0,a.jsx)("h1",{className:"font-bold text-lg",children:"Drag & Drop an SVG to Upload"}),(0,a.jsx)("p",{children:"Drop a compatible SVG anywhere to begin separating its colors."})]})})}var j=l(5874),C=l(5018),S=l(2836),k=l(1942);function N(e){let{color:t,name:l,active:o,toggleColor:r,disabled:n=!1}=e,s=(0,i.useCallback)(()=>{r(t)},[t,r]),c=n?"#cbd5e1":t,d=n?"":"hover:scale-110";return(0,a.jsx)(C.u,{label:l,children:(0,a.jsx)("button",{className:"rounded-full bg-transparent transition-all m-1 focus:outline w-8 h-8 ".concat(d),style:{borderWidth:o?"0.2rem":"1rem",borderColor:c,outlineColor:c},onClick:s,disabled:n})})}function D(e){let{colors:t,toggleColor:l,disabled:o}=e,r=[...t].map(e=>{let[t,[r,n]]=e;return(0,a.jsx)(N,{color:t,name:r,toggleColor:l,active:n,disabled:o},t)});return(0,a.jsx)("div",{className:"flex flex-wrap justify-center",children:r})}var E=l(3710),I=l(4379),M=l(5364),P=l(4537);let R=[["#f15060","bright red"],["#ff48b0","fluorescent pink"],["#ffe800","yellow"],["#00a95c","green"],["#0078bf","blue"],["#000000","black"]],G=[["#00ffff","cyan"],["#ff00ff","magenta"],["#ffff00","yellow"],["#000000","black"]];function V(e){let{colors:t,setPalette:l,addColor:o}=e;(0,i.useEffect)(()=>{l(R)},[l]);let[r,n]=(0,i.useState)(""),s=(0,i.useCallback)(e=>{n(e.target.value)},[n]),[c,d]=(0,i.useState)("#000000"),u=(0,i.useCallback)(e=>{d(e.target.value)},[d]),f=(0,i.useCallback)(()=>{o(c,r)},[c,r,o]),h=r&&!t.has(c),p=r?t.has(c)?"can only add unique colors":void 0:"must name added colors";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(E.B,{children:[(0,a.jsx)(I.I,{placeholder:"Color Name",value:r,onChange:s}),(0,a.jsx)(I.I,{type:"color",style:{borderRadius:0,borderLeft:0,width:"8rem"},value:c,onChange:u}),(0,a.jsx)(M.xW,{style:{padding:0},children:(0,a.jsx)(C.u,{label:p,children:(0,a.jsx)(j.z,{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isDisabled:!h,onClick:f,children:"Add"})})})]}),(0,a.jsxs)(P.P,{placeholder:"Select Palette",onChange:e=>{let t=e.target.value;"none"===t?l([]):"riso"===t?l(R):"cmyk"===t&&l(G)},children:[(0,a.jsx)("option",{value:"none",children:"None"}),(0,a.jsx)("option",{value:"riso",children:"Risograph"}),(0,a.jsx)("option",{value:"cmyk",children:"CMYK"})]})]})}function B(e){let{children:t}=e;return(0,a.jsx)("h2",{className:"font-bold text-lg",children:t})}function z(e){let{colors:t,modifyColors:l,increments:o,setIncrements:r,download:n,isDownloading:s,setShowRaw:c,rendering:d}=e,u=t.size?void 0:"must select at least one color to export",f=(0,i.useCallback)(()=>{c(!0)},[c]),h=(0,i.useCallback)(()=>{c(!1)},[c]),p=(0,i.useCallback)(e=>{l({action:"toggle",color:e})},[l]),g=(0,i.useCallback)(e=>{l({action:"set",colors:e})},[l]),m=(0,i.useCallback)((e,t)=>{l({action:"add",color:e,name:t})},[l]),x=[...t.values()].some(e=>{let[,t]=e;return t});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.z,{className:"w-full",isDisabled:!x,onMouseDown:f,onMouseUp:h,children:"Toggle Original"}),(0,a.jsx)(C.u,{label:u,children:(0,a.jsx)(j.z,{className:"w-full",isDisabled:!x,onClick:n,leftIcon:(0,a.jsx)(k.ZJh,{}),isLoading:s,children:"Export Separation"})}),(0,a.jsx)(B,{children:"Colors"}),(0,a.jsx)("p",{children:"Click a color to toggle its use in the separation"}),(0,a.jsx)(D,{colors:t,toggleColor:p,disabled:d}),(0,a.jsx)(B,{children:"ette"}),(0,a.jsx)("p",{children:"Add new colors or reset to a palette"}),(0,a.jsx)(V,{setPalette:g,colors:t,addColor:m}),(0,a.jsx)(B,{children:"Dicretizations"}),(0,a.jsx)("p",{children:"Drag the slider to change the number of dicrete opacities, this produces a more posterized appearance."}),(0,a.jsx)("div",{className:"px-4",children:(0,a.jsxs)(S.iR,{defaultValue:o,onChangeEnd:r,min:0,max:7,step:1,isDisabled:d,children:[(0,a.jsx)(S.Uj,{children:(0,a.jsx)(S.Ms,{})}),(0,a.jsx)(S.gs,{})]})})]})}var A=l(1493);function L(e){let{helpDisabled:t,toggleHelp:l}=e;return(0,a.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,a.jsx)(C.u,{label:"show help",children:(0,a.jsx)(A.h,{"aria-label":"show help information",icon:(0,a.jsx)(k.DAO,{}),isDisabled:t,onClick:l})}),(0,a.jsx)("a",{href:"https://github.com/hafaio/color-separation",target:"_blank",rel:"noreferrer",children:(0,a.jsx)(A.h,{"aria-label":"view source on github",icon:(0,a.jsx)(k.hJX,{})})})]})}function O(e){let{closeable:t}=e,l=t?(0,a.jsx)("p",{className:"pt-4 pb-4",children:"Click the info button below to hide this information."}):null;return(0,a.jsxs)("div",{className:"flex flex-col justify-between flex-grow",children:[(0,a.jsxs)("div",{className:"space-y-1 flex-grow",children:[(0,a.jsx)("p",{children:"Separate an SVG into spot colors; useful for risograph printing. Currently this assumes a naive subtractive color model, that works reasonably, but could probably be improved."}),(0,a.jsxs)("ol",{className:"list-decimal ml-4",children:[(0,a.jsx)("li",{children:"Upload your SVG by clicking above or dropping it anywhere."}),(0,a.jsx)("li",{children:"Customize your color pallette by adding colors available."}),(0,a.jsx)("li",{children:"Select different colors and losses to check our your decomposition."}),(0,a.jsx)("li",{children:"Click export to download an individual SVG for each layer."})]})]}),l]})}var _=l(4262),U=l(3059),Z=l(2159);l(4331);let F=(0,_.B1)({config:{initialColorMode:"system",useSystemColorMode:!0}},(0,U.A)({colorScheme:"gray"}));function T(e){let{children:t}=e;return(0,a.jsx)(Z.x,{theme:F,children:t})}function q(e){let{onFile:t,loading:l=!1}=e,o=(0,i.useRef)(null);return(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{ref:o,type:"file",accept:"image/svg+xml, image/png, image/jpeg",onChange:e=>{var l;let a=null===(l=e.target.files)||void 0===l?void 0:l[0];a&&t(a)},className:"hidden"}),(0,a.jsx)(j.z,{className:"w-full",isLoading:l,onClick:()=>{var e;null===(e=o.current)||void 0===e||e.click()},leftIcon:(0,a.jsx)(k.Gq2,{}),children:"Upload"})]})}function H(){let[e,t]=(0,i.useState)(!1),[l,h]=(0,i.useState)(!1),[p,g]=(0,i.useState)(!1),[m,x]=(0,i.useState)(!1),y=(0,i.useCallback)(()=>{h(!l)},[l,h]),j=(0,o.p)(),C=(0,i.useRef)(null),[S,k]=(0,i.useState)(),[N,D]=(0,i.useReducer)((e,t)=>{if("set"===t.action)return new Map(t.colors.map(e=>{let[t,l]=e;return[t,[l,!1]]}));if("add"===t.action){let l=new Map(e);return l.set(t.color,[t.name,!1]),l}if("toggle"!==t.action)return new Map([...e].map(e=>{let[t,[l]]=e;return[t,[l,!1]]}));{let l=new Map(e),[a,o]=l.get(t.color);return l.set(t.color,[a,!o]),l}},new Map),[E,I]=(0,i.useState)(),[M,P]=(0,i.useState)(0);(0,i.useEffect)(()=>{S&&[...N.values()].some(e=>{let[,t]=e;return t})?(async()=>{try{g(!0);let e=[];for(let[t,[,l]]of N)l&&e.push(r.ZP(t));let t=await d(S.preview),l=await w(t,e,M),a=await u(l);I(a)}catch(e){console.error(e),I(void 0),j({title:"Couldn't separate image",status:"error",position:"bottom-left"})}finally{g(!1)}})():I(void 0)},[N,M,S,I,j]);let R=(0,i.useCallback)(()=>{S&&(async()=>{try{x(!0);let e=S.raw.name,t=e.slice(0,e.lastIndexOf("."))||e,l=[],a=[];for(let[e,[t,o]]of N)o&&(l.push(r.ZP(e)),a.push(t));let o=await b(S.raw,l,M);for(let[e,l]of a.entries()){let a=o[e],r=(0,s.extension)(a.type);(0,n.saveAs)(a,"".concat(t,"_").concat(l.replace(" ","_"),".").concat(r))}}catch(e){console.error(e),j({title:"Couldn't separate image",status:"error",position:"bottom-left"})}finally{x(!1)}})()},[S,N,j,M]),G=(0,i.useCallback)(e=>{(async()=>{try{k(null),h(!1),D({action:"clear"});let{clientWidth:t,clientHeight:l}=C.current,a=await f(e,t,l),o=await u(a);k({raw:e,preview:o})}catch(e){console.error(e),j({title:"Couldn't load file",status:"error",position:"bottom-left"}),k(void 0)}})()},[k,h,j]),V=S&&!l?(0,a.jsx)(z,{colors:N,modifyColors:D,increments:M,setIncrements:P,download:R,isDownloading:m,setShowRaw:t,rendering:p}):(0,a.jsx)(O,{closeable:!!S}),B=e?null==S?void 0:S.preview:null!=E?E:null==S?void 0:S.preview,A=B?(0,a.jsx)("img",{src:B,alt:"rendered separation",className:"h-full w-full object-contain"}):null,_=(0,i.useCallback)((e,t)=>{let[l]=e;l&&G(l),t.length&&j({title:"Dropped file was not an SVG, PNG, or JPEG",status:"error",position:"bottom-left"})},[G,j]),{getRootProps:U,getInputProps:Z,isDragActive:F}=(0,c.uI)({onDrop:_,accept:{"image/svg+xml":[],"image/png":[],"image/jpeg":[]},multiple:!1,noClick:!0});return(0,a.jsx)(T,{children:(0,a.jsxs)("div",{...U({className:"h-screen w-screen flex flex-row"}),children:[(0,a.jsx)("input",{...Z()}),(0,a.jsx)(v,{show:F}),(0,a.jsxs)("div",{className:"w-72 h-full p-2 overflow-y-auto flex flex-col flex-shrink-0 justify-between",children:[(0,a.jsxs)("div",{className:"space-y-2 flex-grow flex flex-col",children:[(0,a.jsx)("h1",{className:"font-bold text-xl text-center",children:"Spot Color Separator"}),(0,a.jsx)(q,{onFile:G,loading:null===S}),V]}),(0,a.jsx)(L,{helpDisabled:!S,toggleHelp:y})]}),(0,a.jsx)("div",{className:"h-full w-full overflow-auto",ref:C,children:A})]})})}},4331:function(){}},function(e){e.O(0,[733,699,632,971,23,744],function(){return e(e.s=8741)}),_N_E=e.O()}]);