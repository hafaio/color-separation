(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{4056:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(3539)}])},3539:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return L}});var o=t(1874),r=t(6446),n=t(1592),a=t(5653),s=t(7756),i=t(4693),c=t(1959),d=t(7204),u=t(7419),f=t(8826),p=t(1275),h=t(1599),m=t(2160),x=t(1718),g=t.n(x),j=t(9953),b=t(6691),v=t(4085);function w(e,l,t){let o=e.get(l);if(void 0!==o)return o;{let o=t(l);return e.set(l,o),o}}function C(e){let l;if(l=e.match(/^#([0-9a-fA-F]{6})$/)){let[,e]=l;return"#".concat(e.toLowerCase())}if(l=e.match(/^#([0-9a-fA-F]{3})$/)){let[,[e,t,o]]=l;return"#".concat(e).concat(e).concat(t).concat(t).concat(o).concat(o).toLowerCase()}if(l=e.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/)){let[,e,t,o,r]=l;return y([e,t,o].map(e=>parseInt(e,16)/255),parseInt(r,16)/255)}if(l=e.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/)){let[,e,t,o]=l;return k([parseInt(e)/255,parseInt(t)/255,parseInt(o)/255])}if(l=e.match(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([-+\d.eE]+)\s*\)$/)){let[,e,t,o,r]=l;return y([e,t,o].map(e=>parseInt(e)/255),parseFloat(r))}throw Error("invalid color format: '".concat(e,"'"))}function y(e,l){return k(e.map(e=>(e-1)*l+1))}function k(e){let l=e.map(e=>Math.round(255*e).toString(16).padStart(2,"0")).join("");return"#".concat(l)}var S=t(6011),N=t(5630);function M(e){return[void 0,void 0,void 0].map((l,t)=>1-parseInt(e.slice(2*t+1,2*t+3),16)/255)}function I(e,l){let t=0;for(let[o,r]of e.entries())t+=r*l[o];return t}function E(e){let{onFile:l,loading:t=!1}=e,n=e=>{var t;let o=null===(t=e.target.files)||void 0===t?void 0:t[0];o&&l(o)},a=(0,j.useRef)(null),s=()=>{var e;null===(e=a.current)||void 0===e||e.click()};return(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{ref:a,type:"file",accept:"image/svg+xml",onChange:n,className:"hidden"}),(0,o.jsx)(r.z,{className:"w-full",isLoading:t,onClick:s,leftIcon:(0,o.jsx)(v.Gq2,{}),children:"Upload"})]})}function _(e){let{color:l,name:t,active:r,toggleColor:a}=e,s=(0,j.useCallback)(()=>a(l),[l,a]);return(0,o.jsx)(n.u,{label:t,children:(0,o.jsx)("button",{className:"rounded-full bg-transparent transition-all m-1 focus:outline hover:scale-110",style:{width:"2rem",height:"2rem",borderWidth:r?"0.2rem":"1rem",borderColor:l,outlineColor:l},onClick:s})})}let z=[["#f15060","bright red"],["#ff48b0","fluorescent pink"],["#ffe800","yellow"],["#00a95c","green"],["#0078bf","blue"],["#000000","black"]],P=[["#00ffff","cyan"],["#ff00ff","magenta"],["#ffff00","yellow"],["#000000","black"]];function D(e){let{colors:l,setPallette:t,addColor:d,paperColor:u,setPaperColor:f}=e,p=e=>{let l=e.target.value;"none"===l?t([]):"riso"===l?t(z):"cmyk"===l&&t(P)};(0,j.useEffect)(()=>t(z),[t]);let[h,m]=(0,j.useState)(""),x=(0,j.useCallback)(e=>m(e.target.value),[m]),[g,b]=(0,j.useState)("#000000"),v=(0,j.useCallback)(e=>b(e.target.value),[b]),w=(0,j.useCallback)(e=>f(e.target.value),[f]),C=(0,j.useCallback)(()=>d(g,h),[g,h,d]),y=h&&!l.has(g),k=h?l.has(g)?"can only add unique colors":void 0:"must name added colors";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a.B,{children:[(0,o.jsx)(s.I,{placeholder:"Color Name",value:h,onChange:x}),(0,o.jsx)(s.I,{type:"color",style:{borderRadius:0,borderLeft:0,width:"8rem"},value:g,onChange:v}),(0,o.jsx)(i.xW,{style:{padding:0},children:(0,o.jsx)(n.u,{label:k,children:(0,o.jsx)(r.z,{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isDisabled:!y,onClick:C,children:"Add"})})})]}),(0,o.jsxs)(c.P,{placeholder:"Select Pallette",onChange:p,children:[(0,o.jsx)("option",{value:"none",children:"None"}),(0,o.jsx)("option",{value:"riso",children:"Risograph"}),(0,o.jsx)("option",{value:"cmyk",children:"CMYK"})]}),(0,o.jsxs)(a.B,{children:[(0,o.jsx)(i.Ui,{children:(0,o.jsx)(n.u,{label:"Set the printed paper color",children:"Paper Color"})}),(0,o.jsx)(s.I,{type:"color",value:u,onChange:w})]})]})}function F(e){let{colors:l,toggleColor:t}=e,r=[...l].map(e=>{let[l,[r,n]]=e;return(0,o.jsx)(_,{color:l,name:r,toggleColor:t,active:n},l)});return(0,o.jsx)("div",{className:"flex flex-wrap justify-center",children:r})}function G(e){let{children:l}=e;return(0,o.jsx)("h2",{className:"font-bold text-lg",children:l})}function R(e){let{colors:l,modifyColors:t,paperColor:a,setPaperColor:s,quadratic:i,toggleQuad:c,increments:f,setIncrements:p,download:h,showRaw:m,setShowRaw:x}=e,g=l.size?void 0:"must select at least one color to export",b=(0,j.useCallback)(()=>x(!0),[x]),w=(0,j.useCallback)(()=>x(!1),[x]),C=(0,j.useCallback)(e=>t({action:"toggle",color:e}),[t]),y=(0,j.useCallback)(e=>t({action:"set",colors:e}),[t]),k=(0,j.useCallback)((e,l)=>t({action:"add",color:e,name:l}),[t]),S=[...l.values()].some(e=>{let[,l]=e;return l});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.z,{className:"w-full",isDisabled:!S,onMouseDown:b,onMouseUp:w,children:"Toggle Original"}),(0,o.jsx)(n.u,{label:g,children:(0,o.jsx)(r.z,{className:"w-full",isDisabled:!S,onClick:h,leftIcon:(0,o.jsx)(v.ZJh,{}),children:"Export Separation"})}),(0,o.jsx)(G,{children:"Colors"}),(0,o.jsx)("p",{children:"Click a color to toggle its use in the separation"}),(0,o.jsx)(F,{colors:l,toggleColor:C}),(0,o.jsx)(G,{children:"Pallette"}),(0,o.jsx)("p",{children:"Add new colors or reset to a pallette"}),(0,o.jsx)(D,{setPallette:y,colors:l,addColor:k,paperColor:a,setPaperColor:s}),(0,o.jsx)(G,{children:"Dicretizations"}),(0,o.jsx)("p",{children:"Drag the slider to change the number of dicrete opacities"}),(0,o.jsx)("div",{className:"px-4",children:(0,o.jsxs)(d.iR,{defaultValue:f,onChange:p,min:0,max:7,step:1,children:[(0,o.jsx)(d.Uj,{children:(0,o.jsx)(d.Ms,{})}),(0,o.jsx)(d.gs,{})]})}),(0,o.jsx)(n.u,{label:"Toggle for different separation",children:(0,o.jsxs)("div",{className:"flex flex-row justify-between items-baseline",children:[(0,o.jsx)("label",{htmlFor:"quadratic",children:(0,o.jsx)(G,{children:"Quadratic Loss"})}),(0,o.jsx)(u.r,{id:"quadratic",onChange:c,isChecked:i})]})})]})}function V(e){let{closeable:l}=e,t=l?(0,o.jsx)("p",{className:"pt-4 pb-4",children:"Click the info button below to hide this information."}):null;return(0,o.jsxs)("div",{className:"flex flex-col justify-between flex-grow",children:[(0,o.jsxs)("div",{className:"space-y-1 flex-grow",children:[(0,o.jsx)("p",{children:"Separate an SVG into spot colors; useful for risograph printing. Currently this assumes a naive color model, and printing on white."}),(0,o.jsxs)("ol",{className:"list-decimal ml-4",children:[(0,o.jsxs)("li",{children:["Upload your SVG by clicking above or dropping it anywhere. Your SVG can contain opacity, but ",(0,o.jsx)("span",{className:"italic",children:"must not"})," ","contain overlapping elements, embedded bitmaps, or gradients."]}),(0,o.jsx)("li",{children:"Customize your color pallette by adding colors available."}),(0,o.jsx)("li",{children:"Select different colors and losses to check our your decomposition."}),(0,o.jsx)("li",{children:"Click export to download an individual SVG for each layer."})]})]}),t]})}function A(e){let{show:l}=e;return(0,o.jsx)("div",{className:"w-screen h-screen fixed backdrop-blur-sm z-10 flex flex-col items-center justify-center ".concat(l?"block":"hidden"),children:(0,o.jsxs)("div",{className:"w-96 p-4 space-y-2 rounded-md shadow-md ".concat((0,f.ff)("bg-white","bg-gray-900")),children:[(0,o.jsx)("h1",{className:"font-bold text-lg",children:"Drag & Drop an SVG to Upload"}),(0,o.jsx)("p",{children:"Drop a compatible SVG anywhere to begin separating its colors."})]})})}function L(){let[e,l]=(0,j.useState)(!1),[t,r]=(0,j.useState)(!1),a=(0,j.useCallback)(()=>r(!t),[t,r]),s=(0,p.p)(),[i,c]=(0,j.useState)(),[d,u]=(0,j.useState)(),[f,x]=(0,j.useReducer)((e,l)=>{if("set"===l.action)return new Map(l.colors.map(e=>{let[l,t]=e;return[l,[t,!1]]}));if("add"===l.action){let t=new Map(e);return t.set(l.color,[l.name,!1]),t}{let t=new Map(e),[o,r]=t.get(l.color);return t.set(l.color,[o,!r]),t}},new Map),[y,_]=(0,j.useState)("#ffffff"),[[z,P],D]=(0,j.useState)([void 0,new Map]),[F,G]=(0,j.useReducer)(e=>!e,!1),[L,T]=(0,j.useState)(0);(0,j.useEffect)(()=>{if(d){if([...f.values()].some(e=>{let[,l]=e;return l})){let e=[];for(let[l,[,t]]of f)t&&e.push(l);let l=new Map;for(let[t,{fill:o,stroke:r}]of d.elems){let{opacities:n,color:a}=function(e,l){let{quadratic:t=!0,paper:o="#ffffff",increments:r=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=M(e),a=M(o),s=n.map((e,l)=>e-a[l]),i=l.map(M),{error:c,opacities:d}=t?function(e,l,t){let o=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),r=[,...l.map((e,t)=>[,...l.map((l,r)=>I(e,l)+(t===r?o[t]:0))])],n=[,...l.map(l=>I(l,e))],a=[,...l.map((e,t)=>[,...l.map((e,l)=>t===l?1:0),...l.map((e,l)=>t===l?-1:0)])],s=[,...l.map(()=>0),...l.map(()=>-1)],{solution:[,...i],value:[,c],message:d,...u}=(0,N.solveQP)(r,n,a,s),f=I(e,e),p=i.reduce((e,l)=>e+1e-4*l*l,0);if(!d)return{error:Math.sqrt(Math.max(2*c+f-p,0))/3,opacities:i.map(e=>{let l=Math.min(Math.max(0,e),1);return t>0?Math.round(l*t)/t:l})};throw Error(d)}(s,i,r):function(e,l,t){let o=Math.max(t,1),r=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),n={},a={},s={};for(let[e,l]of r.entries())a["mix ".concat(e)]={error:l};for(let[t,r]of e.entries()){let e="up ".concat(t);n[e]={max:r};let s="dn ".concat(t);n[s]={min:r};let i="slack ".concat(t);for(let[r,n]of(a[i]={error:1,[e]:-1,[s]:1},l.entries())){let l=n[t],i="mix ".concat(r);a[i][e]=l/o,a[i][s]=l/o}}if(t>0)for(let[e,l]of r.entries())s["mix ".concat(e)]=1;let{result:i,feasible:c,bounded:d,...u}=S.Solve.call({},{optimize:"error",opType:"min",constraints:n,variables:a,ints:s});if(c&&d){var f;let e=l.map((e,l)=>(null!==(f=u["mix ".concat(l)])&&void 0!==f?f:0)/o),t=e.reduce((e,l,t)=>e+r[t]*l,0);return{error:(i-t)/3,opacities:e}}throw Error("couldn't find bounded feasible solution")}(s,i,r),u=[...a];for(let[e,l]of i.entries()){let t=d[e];for(let[e,o]of l.entries())u[e]+=o*t}return{error:c,opacities:d,color:k(u.map(e=>Math.min(e,1)).map(e=>1-e))}}(t,e,{quadratic:F,paper:y,increments:L});for(let e of o)e.style.fill=a;for(let e of r)e.style.stroke=a;l.set(t,n)}let t=new XMLSerializer,o=t.serializeToString(d.doc);D(["data:image/svg+xml,".concat(encodeURIComponent(o)),l])}else{var e;for(let[l,{fill:t,stroke:o}]of null!==(e=null==d?void 0:d.elems)&&void 0!==e?e:[]){for(let e of t)e.style.fill=l;for(let e of o)e.style.stroke=l}D([void 0,new Map])}}else D([void 0,new Map])},[f,F,L,d,D,y]);let U=(0,j.useCallback)(()=>{if(d&&P.size&&i){let e=i.slice(0,i.lastIndexOf("."))||i,l=new XMLSerializer,t=0;for(let[o,[r,n]]of f)if(n){for(let[e,{fill:l,stroke:o}]of d.elems){let r=P.get(e)[t],n=Math.round(255*(1-r)).toString(16),a="#".concat(n).concat(n).concat(n);for(let e of l)e.style.fill=a;for(let e of o)e.style.stroke=a}let o=l.serializeToString(d.doc),n=new Blob([o],{type:"image/svg+xml"});(0,m.saveAs)(n,"".concat(e,"_").concat(r.replace(" ","_"),".svg")),t++}}},[d,P,f,i]),q=(0,j.useCallback)(async e=>{let l,t;c(e.name),u(null),r(!1);try{let o=await e.text(),r=new DOMParser,n=r.parseFromString(o,"image/svg+xml");(t=document.createElement("div")).style.display="none";let a=t.attachShadow({mode:"open"});for(let e of n.children)a.appendChild(e);document.documentElement.appendChild(t);let s=new Map;for(let e of a.querySelectorAll("*"))if(e instanceof SVGElement){let{fill:t,stroke:o}=getComputedStyle(e);if(t&&"none"!==t)try{let l=C(t),o=w(s,l,()=>({fill:[],stroke:[]})).fill;o.push(e)}catch(t){console.error("problem parsing color",t),l="Problem parsing colors in SVG",e.style.fill="none"}if(o&&"none"!==o)try{let l=C(o),t=w(s,l,()=>({fill:[],stroke:[]})).stroke;t.push(e)}catch(t){console.error("problem parsing color",t),l="Problem parsing colors in SVG",e.style.stroke="none"}}for(let e of a.children)n.appendChild(e);u({raw:"data:image/svg+xml,".concat(encodeURIComponent(o)),doc:n,elems:s})}catch(e){console.error(e),l="Problem loading SVG",u(void 0)}finally{try{t&&document.documentElement.removeChild(t)}catch(e){}}l&&s({title:l,status:"error",position:"bottom-left"})},[u,c,r,s]),O=d&&!t?(0,o.jsx)(R,{colors:f,modifyColors:x,paperColor:y,setPaperColor:_,quadratic:F,toggleQuad:G,increments:L,setIncrements:T,download:U,showRaw:e,setShowRaw:l}):(0,o.jsx)(V,{closeable:!!d}),X=e?null==d?void 0:d.raw:null!=z?z:null==d?void 0:d.raw,$=X?(0,o.jsx)("img",{src:X,alt:"rendered separation",className:"h-full w-full object-contain"}):null,B=(0,j.useCallback)((e,l)=>{let[t]=e;t&&q(t),l.length&&s({title:"Dropped file was not an SVG",status:"error",position:"bottom-left"})},[q,s]),{getRootProps:Q,getInputProps:J,isDragActive:W}=(0,b.uI)({onDrop:B,accept:{"image/svg+xml":[]},multiple:!1,noClick:!0});return(0,o.jsxs)("div",{...Q({className:"h-screen w-screen flex flex-row"}),children:[(0,o.jsx)(g(),{children:(0,o.jsx)("title",{children:"Spot Color Separation"})}),(0,o.jsx)("input",{...J()}),(0,o.jsx)(A,{show:W}),(0,o.jsxs)("div",{className:"w-72 h-full p-2 overflow-y-auto flex flex-col flex-shrink-0 justify-between",children:[(0,o.jsxs)("div",{className:"space-y-2 flex-grow flex flex-col",children:[(0,o.jsx)("h1",{className:"font-bold text-xl text-center",children:"Spot Color Separator"}),(0,o.jsx)(E,{onFile:q,loading:null===d}),O]}),(0,o.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,o.jsx)(n.u,{label:"show help",children:(0,o.jsx)(h.h,{"aria-label":"show help information",icon:(0,o.jsx)(v.DAO,{}),isDisabled:!d,onClick:a})}),(0,o.jsx)("a",{href:"https://github.com/hafaio/color-separation",target:"_blank",rel:"noreferrer",children:(0,o.jsx)(h.h,{"aria-label":"view source on github",icon:(0,o.jsx)(v.hJX,{})})})]})]}),(0,o.jsx)("div",{className:"h-full w-full overflow-auto",children:$})]})}},3281:function(){},1805:function(){}},function(e){e.O(0,[219,996,774,888,179],function(){return e(e.s=4056)}),_N_E=e.O()}]);