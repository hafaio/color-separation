(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3227:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(7059)}])},7059:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return T}});var o=t(1874),r=t(3285),a=t(1652),n=t(7570),s=t(3044),i=t(7122),c=t(7815),d=t(4399),u=t(6429),f=t(8473),h=t(6542),p=t(4),m=t(2160),x=t(170),j=t.n(x),g=t(9953),b=t(6691),v=t(3994);function w(e){let l;if(l=e.match(/^#([0-9a-fA-F]{6})$/)){let[,e]=l;return"#".concat(e.toLowerCase())}if(l=e.match(/^#([0-9a-fA-F]{3})$/)){let[,[e,t,o]]=l;return"#".concat(e).concat(e).concat(t).concat(t).concat(o).concat(o).toLowerCase()}if(l=e.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/)){let[,e,t,o,r]=l;return C([e,t,o].map(e=>parseInt(e,16)/255),parseInt(r,16)/255)}if(l=e.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/)){let[,e,t,o]=l;return y([parseInt(e)/255,parseInt(t)/255,parseInt(o)/255])}if(l=e.match(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([-+\d.eE]+)\s*\)$/)){let[,e,t,o,r]=l;return C([e,t,o].map(e=>parseInt(e)/255),parseFloat(r))}throw Error("invalid color format: '".concat(e,"'"))}function C(e,l){return y(e.map(e=>(e-1)*l+1))}function y(e){let l=e.map(e=>Math.round(255*e).toString(16).padStart(2,"0")).join("");return"#".concat(l)}let S=["fill","stroke","stopColor"];function k(e,l){for(let n of e.querySelectorAll("*")){var t,o,r,a;if(n instanceof SVGStyleElement){let e=[...null!==(o=null===(t=n.sheet)||void 0===t?void 0:t.cssRules)&&void 0!==o?o:[]];for(let t of e)if(t instanceof CSSStyleRule)for(let e of S)try{let o=w(t.style[e]);t.style[e]=null!==(r=l.get(o))&&void 0!==r?r:""}catch(e){}n.textContent=e.map(e=>e.cssText).join("\n")}else if(n instanceof SVGElement)for(let e of S)try{let t=w(n.style[e]);n.style[e]=null!==(a=l.get(t))&&void 0!==a?a:""}catch(e){}}}var N=t(6011),M=t(5630);function I(e){return[void 0,void 0,void 0].map((l,t)=>1-parseInt(e.slice(2*t+1,2*t+3),16)/255)}function R(e,l){let t=0;for(let[o,r]of e.entries())t+=r*l[o];return t}function E(e){let{onFile:l,loading:t=!1}=e,a=e=>{var t;let o=null===(t=e.target.files)||void 0===t?void 0:t[0];o&&l(o)},n=(0,g.useRef)(null),s=()=>{var e;null===(e=n.current)||void 0===e||e.click()};return(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{ref:n,type:"file",accept:"image/svg+xml",onChange:a,className:"hidden"}),(0,o.jsx)(r.z,{className:"w-full",isLoading:t,onClick:s,leftIcon:(0,o.jsx)(v.Gq2,{}),children:"Upload"})]})}function P(e){let{color:l,name:t,active:r,toggleColor:n}=e,s=(0,g.useCallback)(()=>n(l),[l,n]);return(0,o.jsx)(a.u,{label:t,children:(0,o.jsx)("button",{className:"rounded-full bg-transparent transition-all m-1 focus:outline hover:scale-110",style:{width:"2rem",height:"2rem",borderWidth:r?"0.2rem":"1rem",borderColor:l,outlineColor:l},onClick:s})})}let _=[["#f15060","bright red"],["#ff48b0","fluorescent pink"],["#ffe800","yellow"],["#00a95c","green"],["#0078bf","blue"],["#000000","black"]],z=[["#00ffff","cyan"],["#ff00ff","magenta"],["#ffff00","yellow"],["#000000","black"]];function A(e){let{colors:l,setPallette:t,addColor:d,paperColor:u,setPaperColor:f}=e,h=e=>{let l=e.target.value;"none"===l?t([]):"riso"===l?t(_):"cmyk"===l&&t(z)};(0,g.useEffect)(()=>t(_),[t]);let[p,m]=(0,g.useState)(""),x=(0,g.useCallback)(e=>m(e.target.value),[m]),[j,b]=(0,g.useState)("#000000"),v=(0,g.useCallback)(e=>b(e.target.value),[b]),w=(0,g.useCallback)(e=>f(e.target.value),[f]),C=(0,g.useCallback)(()=>d(j,p),[j,p,d]),y=p&&!l.has(j),S=p?l.has(j)?"can only add unique colors":void 0:"must name added colors";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.B,{children:[(0,o.jsx)(s.I,{placeholder:"Color Name",value:p,onChange:x}),(0,o.jsx)(s.I,{type:"color",style:{borderRadius:0,borderLeft:0,width:"8rem"},value:j,onChange:v}),(0,o.jsx)(i.xW,{style:{padding:0},children:(0,o.jsx)(a.u,{label:S,children:(0,o.jsx)(r.z,{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isDisabled:!y,onClick:C,children:"Add"})})})]}),(0,o.jsxs)(c.P,{placeholder:"Select Pallette",onChange:h,children:[(0,o.jsx)("option",{value:"none",children:"None"}),(0,o.jsx)("option",{value:"riso",children:"Risograph"}),(0,o.jsx)("option",{value:"cmyk",children:"CMYK"})]}),(0,o.jsxs)(n.B,{children:[(0,o.jsx)(i.Ui,{children:(0,o.jsx)(a.u,{label:"Set the printed paper color",children:"Paper Color"})}),(0,o.jsx)(s.I,{type:"color",value:u,onChange:w})]})]})}function D(e){let{colors:l,toggleColor:t}=e,r=[...l].map(e=>{let[l,[r,a]]=e;return(0,o.jsx)(P,{color:l,name:r,toggleColor:t,active:a},l)});return(0,o.jsx)("div",{className:"flex flex-wrap justify-center",children:r})}function F(e){let{children:l}=e;return(0,o.jsx)("h2",{className:"font-bold text-lg",children:l})}function G(e){let{colors:l,modifyColors:t,paperColor:n,setPaperColor:s,quadratic:i,toggleQuad:c,usePaper:f,togglePaper:h,increments:p,setIncrements:m,download:x,showRaw:j,setShowRaw:b}=e,w=l.size?void 0:"must select at least one color to export",C=(0,g.useCallback)(()=>b(!0),[b]),y=(0,g.useCallback)(()=>b(!1),[b]),S=(0,g.useCallback)(e=>t({action:"toggle",color:e}),[t]),k=(0,g.useCallback)(e=>t({action:"set",colors:e}),[t]),N=(0,g.useCallback)((e,l)=>t({action:"add",color:e,name:l}),[t]),M=[...l.values()].some(e=>{let[,l]=e;return l});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.z,{className:"w-full",isDisabled:!M,onMouseDown:C,onMouseUp:y,children:"Toggle Original"}),(0,o.jsx)(a.u,{label:w,children:(0,o.jsx)(r.z,{className:"w-full",isDisabled:!M,onClick:x,leftIcon:(0,o.jsx)(v.ZJh,{}),children:"Export Separation"})}),(0,o.jsx)(F,{children:"Colors"}),(0,o.jsx)("p",{children:"Click a color to toggle its use in the separation"}),(0,o.jsx)(D,{colors:l,toggleColor:S}),(0,o.jsx)(F,{children:"Pallette"}),(0,o.jsx)("p",{children:"Add new colors or reset to a pallette"}),(0,o.jsx)(A,{setPallette:k,colors:l,addColor:N,paperColor:n,setPaperColor:s}),(0,o.jsx)(F,{children:"Dicretizations"}),(0,o.jsx)("p",{children:"Drag the slider to change the number of dicrete opacities"}),(0,o.jsx)("div",{className:"px-4",children:(0,o.jsxs)(d.iR,{defaultValue:p,onChange:m,min:0,max:7,step:1,children:[(0,o.jsx)(d.Uj,{children:(0,o.jsx)(d.Ms,{})}),(0,o.jsx)(d.gs,{})]})}),(0,o.jsx)(a.u,{label:"Toggle for different separation",children:(0,o.jsxs)("div",{className:"flex flex-row justify-between items-baseline",children:[(0,o.jsx)("label",{htmlFor:"quadratic",children:(0,o.jsx)(F,{children:"Quadratic Loss"})}),(0,o.jsx)(u.r,{id:"quadratic",onChange:c,isChecked:i})]})}),(0,o.jsx)(a.u,{label:"Account for paper color when doing separation",children:(0,o.jsxs)("div",{className:"flex flex-row justify-between items-baseline",children:[(0,o.jsx)("label",{htmlFor:"account-paper-color",children:(0,o.jsx)(F,{children:"Account for Paper Color"})}),(0,o.jsx)(u.r,{id:"account-paper-color",onChange:h,isChecked:f})]})})]})}function V(e){let{closeable:l}=e,t=l?(0,o.jsx)("p",{className:"pt-4 pb-4",children:"Click the info button below to hide this information."}):null;return(0,o.jsxs)("div",{className:"flex flex-col justify-between flex-grow",children:[(0,o.jsxs)("div",{className:"space-y-1 flex-grow",children:[(0,o.jsx)("p",{children:"Separate an SVG into spot colors; useful for risograph printing. Currently this assumes a naive color model, and printing on white."}),(0,o.jsxs)("ol",{className:"list-decimal ml-4",children:[(0,o.jsxs)("li",{children:["Upload your SVG by clicking above or dropping it anywhere. Your SVG can contain opacity, but ",(0,o.jsx)("span",{className:"italic",children:"must not"})," ","contain overlapping elements, embedded bitmaps, or gradients."]}),(0,o.jsx)("li",{children:"Customize your color pallette by adding colors available."}),(0,o.jsx)("li",{children:"Select different colors and losses to check our your decomposition."}),(0,o.jsx)("li",{children:"Click export to download an individual SVG for each layer."})]})]}),t]})}function L(e){let{show:l}=e;return(0,o.jsx)("div",{className:"w-screen h-screen fixed backdrop-blur-sm z-10 flex flex-col items-center justify-center ".concat(l?"block":"hidden"),children:(0,o.jsxs)("div",{className:"w-96 p-4 space-y-2 rounded-md shadow-md ".concat((0,f.ff)("bg-white","bg-gray-900")),children:[(0,o.jsx)("h1",{className:"font-bold text-lg",children:"Drag & Drop an SVG to Upload"}),(0,o.jsx)("p",{children:"Drop a compatible SVG anywhere to begin separating its colors."})]})})}function T(){let[e,l]=(0,g.useState)(!1),[t,r]=(0,g.useState)(!1),n=(0,g.useCallback)(()=>r(!t),[t,r]),s=(0,h.p)(),[i,c]=(0,g.useState)(),[d,u]=(0,g.useState)(),[f,x]=(0,g.useReducer)((e,l)=>{if("set"===l.action)return new Map(l.colors.map(e=>{let[l,t]=e;return[l,[t,!1]]}));if("add"===l.action){let t=new Map(e);return t.set(l.color,[l.name,!1]),t}{let t=new Map(e),[o,r]=t.get(l.color);return t.set(l.color,[o,!r]),t}},new Map),[C,P]=(0,g.useState)("#ffffff"),[[_,z],A]=(0,g.useState)([void 0,new Map]),[D,F]=(0,g.useReducer)(e=>!e,!1),[T,q]=(0,g.useReducer)(e=>!e,!0),[U,O]=(0,g.useState)(0);(0,g.useEffect)(()=>{if(d&&[...f.values()].some(e=>{let[,l]=e;return l})){let e=[];for(let[l,[,t]]of f)t&&e.push(l);let l=new Map,t=new Map;for(let o of d.colors){let{opacities:r,color:a}=function(e,l){let{quadratic:t=!0,paper:o="#ffffff",increments:r=0,factorPaper:a=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=I(e),s=I(o);a&&(n=n.map((e,l)=>Math.max(e-s[l],0)));let i=l.map(I),{error:c,opacities:d}=t?function(e,l,t){let o=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),r=[,...l.map((e,t)=>[,...l.map((l,r)=>R(e,l)+(t===r?o[t]:0))])],a=[,...l.map(l=>R(l,e))],n=[,...l.map((e,t)=>[,...l.map((e,l)=>t===l?1:0),...l.map((e,l)=>t===l?-1:0)])],s=[,...l.map(()=>0),...l.map(()=>-1)],{solution:[,...i],value:[,c],message:d,...u}=(0,M.solveQP)(r,a,n,s),f=R(e,e),h=i.reduce((e,l)=>e+1e-4*l*l,0);if(!d)return{error:Math.sqrt(Math.max(2*c+f-h,0))/3,opacities:i.map(e=>{let l=Math.min(Math.max(0,e),1);return t>0?Math.round(l*t)/t:l})};throw Error(d)}(n,i,r):function(e,l,t){let o=Math.max(t,1),r=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),a={},n={},s={};for(let[e,l]of r.entries())n["mix ".concat(e)]={error:l};for(let[t,r]of e.entries()){let e="up ".concat(t);a[e]={max:r};let s="dn ".concat(t);a[s]={min:r};let i="slack ".concat(t);for(let[r,a]of(n[i]={error:1,[e]:-1,[s]:1},l.entries())){let l=a[t],i="mix ".concat(r);n[i][e]=l/o,n[i][s]=l/o}}if(t>0)for(let[e,l]of r.entries())s["mix ".concat(e)]=1;let{result:i,feasible:c,bounded:d,...u}=N.Solve.call({},{optimize:"error",opType:"min",constraints:a,variables:n,ints:s});if(c&&d){var f;let e=l.map((e,l)=>(null!==(f=u["mix ".concat(l)])&&void 0!==f?f:0)/o),t=e.reduce((e,l,t)=>e+r[t]*l,0);return{error:(i-t)/3,opacities:e}}throw Error("couldn't find bounded feasible solution")}(n,i,r),u=[...s];for(let[e,l]of i.entries()){let t=d[e];for(let[e,o]of l.entries())u[e]+=o*t}return{error:c,opacities:d,color:y(u.map(e=>Math.min(e,1)).map(e=>1-e))}}(o,e,{quadratic:D,paper:C,increments:U,factorPaper:T});l.set(o,r),t.set(o,a)}let o=d.doc.cloneNode(!0);k(o,t);let r=new XMLSerializer,a=r.serializeToString(o);A(["data:image/svg+xml,".concat(encodeURIComponent(a)),l])}else A([void 0,new Map])},[f,D,U,d,A,C,T]);let X=(0,g.useCallback)(()=>{if(d&&z.size&&i){let e=i.slice(0,i.lastIndexOf("."))||i,l=new XMLSerializer,t=0;for(let[o,[r,a]]of f)if(a){let o=new Map;for(let e of d.colors){let l=z.get(e)[t],r=Math.round(255*(1-l)).toString(16),a="#".concat(r).concat(r).concat(r);o.set(e,a)}let a=d.doc.cloneNode(!0);k(a,o);let n=l.serializeToString(a),s=new Blob([n],{type:"image/svg+xml"});(0,m.saveAs)(s,"".concat(e,"_").concat(r.replace(" ","_"),".svg")),t++}}},[d,z,f,i]),$=(0,g.useCallback)(async e=>{c(e.name),u(null),r(!1);try{let l=await e.text(),t=new DOMParser,o=t.parseFromString(l,"image/svg+xml"),r=[...function(e){let l=new Set;for(let r of e.querySelectorAll("*"))if(r instanceof SVGStyleElement){var t,o;for(let e of null!==(o=null===(t=r.sheet)||void 0===t?void 0:t.cssRules)&&void 0!==o?o:[])if(e instanceof CSSStyleRule)for(let t of S)try{l.add(w(e.style[t]))}catch(e){}}else if(r instanceof SVGElement)for(let e of S)try{l.add(w(r.style[e]))}catch(e){}return l}(o)];u({raw:"data:image/svg+xml,".concat(encodeURIComponent(l)),doc:o,colors:r})}catch(e){console.error(e),s({title:"Problem loading SVG",status:"error",position:"bottom-left"}),u(void 0)}},[u,c,r,s]),B=d&&!t?(0,o.jsx)(G,{colors:f,modifyColors:x,paperColor:C,setPaperColor:P,quadratic:D,toggleQuad:F,usePaper:T,togglePaper:q,increments:U,setIncrements:O,download:X,showRaw:e,setShowRaw:l}):(0,o.jsx)(V,{closeable:!!d}),Q=e?null==d?void 0:d.raw:null!=_?_:null==d?void 0:d.raw,J=Q?(0,o.jsx)("img",{src:Q,alt:"rendered separation",className:"h-full w-full object-contain"}):null,W=(0,g.useCallback)((e,l)=>{let[t]=e;t&&$(t),l.length&&s({title:"Dropped file was not an SVG",status:"error",position:"bottom-left"})},[$,s]),{getRootProps:Y,getInputProps:K,isDragActive:Z}=(0,b.uI)({onDrop:W,accept:{"image/svg+xml":[]},multiple:!1,noClick:!0});return(0,o.jsxs)("div",{...Y({className:"h-screen w-screen flex flex-row"}),children:[(0,o.jsx)(j(),{children:(0,o.jsx)("title",{children:"Spot Color Separation"})}),(0,o.jsx)("input",{...K()}),(0,o.jsx)(L,{show:Z}),(0,o.jsxs)("div",{className:"w-72 h-full p-2 overflow-y-auto flex flex-col flex-shrink-0 justify-between",children:[(0,o.jsxs)("div",{className:"space-y-2 flex-grow flex flex-col",children:[(0,o.jsx)("h1",{className:"font-bold text-xl text-center",children:"Spot Color Separator"}),(0,o.jsx)(E,{onFile:$,loading:null===d}),B]}),(0,o.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,o.jsx)(a.u,{label:"show help",children:(0,o.jsx)(p.h,{"aria-label":"show help information",icon:(0,o.jsx)(v.DAO,{}),isDisabled:!d,onClick:n})}),(0,o.jsx)("a",{href:"https://github.com/hafaio/color-separation",target:"_blank",rel:"noreferrer",children:(0,o.jsx)(p.h,{"aria-label":"view source on github",icon:(0,o.jsx)(v.hJX,{})})})]})]}),(0,o.jsx)("div",{className:"h-full w-full overflow-auto",style:{backgroundColor:C},children:J})]})}},3281:function(){},1805:function(){}},function(e){e.O(0,[718,726,774,888,179],function(){return e(e.s=3227)}),_N_E=e.O()}]);