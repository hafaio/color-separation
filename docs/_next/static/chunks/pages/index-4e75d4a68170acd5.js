(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3074:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(4077)}])},4077:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return R}});var o=t(1874),r=t(2816),n=t(3843),a=t(1908),s=t(5998),i=t(4978),c=t(8966),d=t(8553),u=t(1541),f=t(2160),p=t(9611),h=t.n(p),m=t(9953),x=t(6691),g=t(4085);function j(e,l,t){let o=e.get(l);if(void 0!==o)return o;{let r=t(l);return e.set(l,r),r}}function b(e){let l;if(l=e.match(/^#([0-9a-fA-F]{6})$/)){let[,t]=l;return"#".concat(t.toLowerCase())}if(l=e.match(/^#([0-9a-fA-F]{3})$/)){let[,[o,r,n]]=l;return"#".concat(o).concat(o).concat(r).concat(r).concat(n).concat(n).toLowerCase()}if(l=e.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/)){let[,a,s,i,c]=l;return v([a,s,i].map(e=>parseInt(e,16)/255),parseInt(c,16)/255)}if(l=e.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/)){let[,d,u,f]=l;return w([parseInt(d)/255,parseInt(u)/255,parseInt(f)/255])}if(l=e.match(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([-+\d.eE]+)\s*\)$/)){let[,p,h,m,x]=l;return v([p,h,m].map(e=>parseInt(e)/255),parseFloat(x))}throw Error("invalid color format: '".concat(e,"'"))}function v(e,l){return w(e.map(e=>(e-1)*l+1))}function w(e){let l=e.map(e=>Math.round(255*e).toString(16).padStart(2,"0")).join("");return"#".concat(l)}var C=t(6011),y=t(5630);function k(e){return[void 0,void 0,void 0].map((l,t)=>1-parseInt(e.slice(2*t+1,2*t+3),16)/255)}function S(e,l){let t=0;for(let[o,r]of e.entries())t+=r*l[o];return t}function N(e){let{onFile:l,loading:t=!1}=e,n=e=>{var t;let o=null===(t=e.target.files)||void 0===t?void 0:t[0];o&&l(o)},a=(0,m.useRef)(null),s=()=>{var e;null===(e=a.current)||void 0===e||e.click()};return(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{ref:a,type:"file",accept:"image/svg+xml",onChange:n,className:"hidden"}),(0,o.jsx)(r.zx,{className:"w-full",isLoading:t,onClick:s,leftIcon:(0,o.jsx)(g.Gq2,{}),children:"Upload"})]})}function M(e){let{color:l,name:t,active:r,toggleColor:a}=e,s=(0,m.useCallback)(()=>a(l),[l,a]);return(0,o.jsx)(n.u,{label:t,children:(0,o.jsx)("button",{className:"rounded-full bg-transparent transition-all m-1 focus:outline hover:scale-110",style:{width:"2rem",height:"2rem",borderWidth:r?"0.2rem":"1rem",borderColor:l,outlineColor:l},onClick:s})})}let I=[["#f15060","bright red"],["#ff48b0","fluorescent pink"],["#ffe800","yellow"],["#00a95c","green"],["#0078bf","blue"],["#000000","black"]],E=[["#00ffff","cyan"],["#ff00ff","magenta"],["#ffff00","yellow"],["#000000","black"]];function _(e){let{colors:l,setPallette:t,addColor:i,paperColor:c,setPaperColor:d}=e,u=e=>{let l=e.target.value;"none"===l?t([]):"riso"===l?t(I):"cmyk"===l&&t(E)};(0,m.useEffect)(()=>t(I),[t]);let[f,p]=(0,m.useState)(""),h=(0,m.useCallback)(e=>p(e.target.value),[p]),[x,g]=(0,m.useState)("#000000"),j=(0,m.useCallback)(e=>g(e.target.value),[g]),b=(0,m.useCallback)(e=>d(e.target.value),[d]),v=(0,m.useCallback)(()=>i(x,f),[x,f,i]),w=f&&!l.has(x),C=f?l.has(x)?"can only add unique colors":void 0:"must name added colors";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a.BZ,{children:[(0,o.jsx)(a.II,{placeholder:"Color Name",value:f,onChange:h}),(0,o.jsx)(a.II,{type:"color",style:{borderRadius:0,borderLeft:0,width:"8rem"},value:x,onChange:j}),(0,o.jsx)(a.xW,{style:{padding:0},children:(0,o.jsx)(n.u,{label:C,children:(0,o.jsx)(r.zx,{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isDisabled:!w,onClick:v,children:"Add"})})})]}),(0,o.jsxs)(s.Ph,{placeholder:"Select Pallette",onChange:u,children:[(0,o.jsx)("option",{value:"none",children:"None"}),(0,o.jsx)("option",{value:"riso",children:"Risograph"}),(0,o.jsx)("option",{value:"cmyk",children:"CMYK"})]}),(0,o.jsxs)(a.BZ,{children:[(0,o.jsx)(a.Ui,{children:(0,o.jsx)(n.u,{label:"Set the printed paper color",children:"Paper Color"})}),(0,o.jsx)(a.II,{type:"color",value:c,onChange:b})]})]})}function z(e){let{colors:l,toggleColor:t}=e,r=[...l].map(e=>{let[l,[r,n]]=e;return(0,o.jsx)(M,{color:l,name:r,toggleColor:t,active:n},l)});return(0,o.jsx)("div",{className:"flex flex-wrap justify-center",children:r})}function P(e){let{children:l}=e;return(0,o.jsx)("h2",{className:"font-bold text-lg",children:l})}function D(e){let{colors:l,modifyColors:t,paperColor:a,setPaperColor:s,quadratic:d,toggleQuad:u,increments:f,setIncrements:p,download:h,showRaw:x,setShowRaw:j}=e,b=l.size?void 0:"must select at least one color to export",v=(0,m.useCallback)(()=>j(!0),[j]),w=(0,m.useCallback)(()=>j(!1),[j]),C=(0,m.useCallback)(e=>t({action:"toggle",color:e}),[t]),y=(0,m.useCallback)(e=>t({action:"set",colors:e}),[t]),k=(0,m.useCallback)((e,l)=>t({action:"add",color:e,name:l}),[t]),S=[...l.values()].some(e=>{let[,l]=e;return l});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.zx,{className:"w-full",isDisabled:!S,onMouseDown:v,onMouseUp:w,children:"Toggle Original"}),(0,o.jsx)(n.u,{label:b,children:(0,o.jsx)(r.zx,{className:"w-full",isDisabled:!S,onClick:h,leftIcon:(0,o.jsx)(g.ZJh,{}),children:"Export Separation"})}),(0,o.jsx)(P,{children:"Colors"}),(0,o.jsx)("p",{children:"Click a color to toggle its use in the separation"}),(0,o.jsx)(z,{colors:l,toggleColor:C}),(0,o.jsx)(P,{children:"Pallette"}),(0,o.jsx)("p",{children:"Add new colors or reset to a pallette"}),(0,o.jsx)(_,{setPallette:y,colors:l,addColor:k,paperColor:a,setPaperColor:s}),(0,o.jsx)(P,{children:"Dicretizations"}),(0,o.jsx)("p",{children:"Drag the slider to change the number of dicrete opacities"}),(0,o.jsx)("div",{className:"px-4",children:(0,o.jsxs)(i.iR,{defaultValue:f,onChange:p,min:0,max:7,step:1,children:[(0,o.jsx)(i.Uj,{children:(0,o.jsx)(i.Ms,{})}),(0,o.jsx)(i.gs,{})]})}),(0,o.jsx)(n.u,{label:"Toggle for different separation",children:(0,o.jsxs)("div",{className:"flex flex-row justify-between items-baseline",children:[(0,o.jsx)("label",{htmlFor:"quadratic",children:(0,o.jsx)(P,{children:"Quadratic Loss"})}),(0,o.jsx)(c.r,{id:"quadratic",onChange:u,isChecked:d})]})})]})}function F(e){let{closeable:l}=e,t=l?(0,o.jsx)("p",{className:"pt-4 pb-4",children:"Click the info button below to hide this information."}):null;return(0,o.jsxs)("div",{className:"flex flex-col justify-between flex-grow",children:[(0,o.jsxs)("div",{className:"space-y-1 flex-grow",children:[(0,o.jsx)("p",{children:"Separate an SVG into spot colors; useful for risograph printing. Currently this assumes a naive color model, and printing on white."}),(0,o.jsxs)("ol",{className:"list-decimal ml-4",children:[(0,o.jsxs)("li",{children:["Upload your SVG by clicking above or dropping it anywhere. Your SVG can contain opacity, but ",(0,o.jsx)("span",{className:"italic",children:"must not"})," ","contain overlapping elements, embedded bitmaps, or gradients."]}),(0,o.jsx)("li",{children:"Customize your color pallette by adding colors available."}),(0,o.jsx)("li",{children:"Select different colors and losses to check our your decomposition."}),(0,o.jsx)("li",{children:"Click export to download an individual SVG for each layer."})]})]}),t]})}function G(e){let{show:l}=e;return(0,o.jsx)("div",{className:"w-screen h-screen fixed backdrop-blur-sm z-10 flex flex-col items-center justify-center ".concat(l?"block":"hidden"),children:(0,o.jsxs)("div",{className:"w-96 p-4 space-y-2 rounded-md shadow-md ".concat((0,d.ff)("bg-white","bg-gray-900")),children:[(0,o.jsx)("h1",{className:"font-bold text-lg",children:"Drag & Drop an SVG to Upload"}),(0,o.jsx)("p",{children:"Drop a compatible SVG anywhere to begin separating its colors."})]})})}function R(){let[e,l]=(0,m.useState)(!1),[t,a]=(0,m.useState)(!1),s=(0,m.useCallback)(()=>a(!t),[t,a]),i=(0,u.pm)(),[c,d]=(0,m.useState)(),[p,v]=(0,m.useState)(),[M,I]=(0,m.useReducer)((e,l)=>{if("set"===l.action)return new Map(l.colors.map(e=>{let[l,t]=e;return[l,[t,!1]]}));if("add"===l.action){let t=new Map(e);return t.set(l.color,[l.name,!1]),t}{let o=new Map(e),[r,n]=o.get(l.color);return o.set(l.color,[r,!n]),o}},new Map),[E,_]=(0,m.useState)("#ffffff"),[[z,P],R]=(0,m.useState)([void 0,new Map]),[V,A]=(0,m.useReducer)(e=>!e,!1),[U,L]=(0,m.useState)(0);(0,m.useEffect)(()=>{if(p){if([...M.values()].some(e=>{let[,l]=e;return l})){let e=[];for(let[l,[,t]]of M)t&&e.push(l);let o=new Map;for(let[r,{fill:n,stroke:a}]of p.elems){let{opacities:s,color:i}=function(e,l){let{quadratic:t=!0,paper:o="#ffffff",increments:r=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=k(e),a=k(o),s=n.map((e,l)=>e-a[l]),i=l.map(k),{error:c,opacities:d}=t?function(e,l,t){let o=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),r=[,...l.map((e,t)=>[,...l.map((l,r)=>S(e,l)+(t===r?o[t]:0))])],n=[,...l.map(l=>S(l,e))],a=[,...l.map((e,t)=>[,...l.map((e,l)=>t===l?1:0),...l.map((e,l)=>t===l?-1:0)])],s=[,...l.map(()=>0),...l.map(()=>-1)],{solution:[,...i],value:[,c],message:d,...u}=(0,y.solveQP)(r,n,a,s),f=S(e,e),p=i.reduce((e,l)=>e+1e-4*l*l,0);if(!d)return{error:Math.sqrt(Math.max(2*c+f-p,0))/3,opacities:i.map(e=>{let l=Math.min(Math.max(0,e),1);return t>0?Math.round(l*t)/t:l})};throw Error(d)}(s,i,r):function(e,l,t){let o=Math.max(t,1),r=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),n={},a={},s={};for(let[i,c]of r.entries())a["mix ".concat(i)]={error:c};for(let[d,u]of e.entries()){let f="up ".concat(d);n[f]={max:u};let p="dn ".concat(d);n[p]={min:u};let h="slack ".concat(d);for(let[m,x]of(a[h]={error:1,[f]:-1,[p]:1},l.entries())){let g=x[d],j="mix ".concat(m);a[j][f]=g/o,a[j][p]=g/o}}if(t>0)for(let[b,v]of r.entries())s["mix ".concat(b)]=1;let{result:w,feasible:y,bounded:k,...S}=C.Solve.call({},{optimize:"error",opType:"min",constraints:n,variables:a,ints:s});if(y&&k){var N;let M=l.map((e,l)=>(null!==(N=S["mix ".concat(l)])&&void 0!==N?N:0)/o),I=M.reduce((e,l,t)=>e+r[t]*l,0);return{error:(w-I)/3,opacities:M}}throw Error("couldn't find bounded feasible solution")}(s,i,r),u=[...a];for(let[f,p]of i.entries()){let h=d[f];for(let[m,x]of p.entries())u[m]+=x*h}return{error:c,opacities:d,color:w(u.map(e=>Math.min(e,1)).map(e=>1-e))}}(r,e,{quadratic:V,paper:E,increments:U});for(let c of n)c.style.fill=i;for(let d of a)d.style.stroke=i;o.set(r,s)}let u=new XMLSerializer,f=u.serializeToString(p.doc);R(["data:image/svg+xml,".concat(encodeURIComponent(f)),o])}else{var h;for(let[m,{fill:x,stroke:g}]of null!==(h=null==p?void 0:p.elems)&&void 0!==h?h:[]){for(let j of x)j.style.fill=m;for(let b of g)b.style.stroke=m}R([void 0,new Map])}}else R([void 0,new Map])},[M,V,U,p,R,E]);let T=(0,m.useCallback)(()=>{if(p&&P.size&&c){let e=c.slice(0,c.lastIndexOf("."))||c,l=new XMLSerializer,t=0;for(let[o,[r,n]]of M)if(n){for(let[a,{fill:s,stroke:i}]of p.elems){let d=P.get(a)[t],u=Math.round(255*(1-d)).toString(16),h="#".concat(u).concat(u).concat(u);for(let m of s)m.style.fill=h;for(let x of i)x.style.stroke=h}let g=l.serializeToString(p.doc),j=new Blob([g],{type:"image/svg+xml"});(0,f.saveAs)(j,"".concat(e,"_").concat(r.replace(" ","_"),".svg")),t++}}},[p,P,M,c]),q=(0,m.useCallback)(async e=>{let l,t;d(e.name),v(null),a(!1);try{let o=await e.text(),r=new DOMParser,n=r.parseFromString(o,"image/svg+xml");(t=document.createElement("div")).style.display="none";let s=t.attachShadow({mode:"open"});for(let c of n.children)s.appendChild(c);document.documentElement.appendChild(t);let u=new Map;for(let f of s.querySelectorAll("*"))if(f instanceof SVGElement){let{fill:p,stroke:h}=getComputedStyle(f);if(p&&"none"!==p)try{let m=b(p),x=j(u,m,()=>({fill:[],stroke:[]})).fill;x.push(f)}catch(g){console.error("problem parsing color",g),l="Problem parsing colors in SVG",f.style.fill="none"}if(h&&"none"!==h)try{let w=b(h),C=j(u,w,()=>({fill:[],stroke:[]})).stroke;C.push(f)}catch(y){console.error("problem parsing color",y),l="Problem parsing colors in SVG",f.style.stroke="none"}}for(let k of s.children)n.appendChild(k);v({raw:"data:image/svg+xml,".concat(encodeURIComponent(o)),doc:n,elems:u})}catch(S){console.error(S),l="Problem loading SVG",v(void 0)}finally{try{t&&document.documentElement.removeChild(t)}catch(N){}}l&&i({title:l,status:"error",position:"bottom-left"})},[v,d,a,i]),O=p&&!t?(0,o.jsx)(D,{colors:M,modifyColors:I,paperColor:E,setPaperColor:_,quadratic:V,toggleQuad:A,increments:U,setIncrements:L,download:T,showRaw:e,setShowRaw:l}):(0,o.jsx)(F,{closeable:!!p}),X=e?null==p?void 0:p.raw:null!=z?z:null==p?void 0:p.raw,$=X?(0,o.jsx)("img",{src:X,alt:"rendered separation",className:"h-full w-full object-contain"}):null,B=(0,m.useCallback)((e,l)=>{let[t]=e;t&&q(t),l.length&&i({title:"Dropped file was not an SVG",status:"error",position:"bottom-left"})},[q,i]),{getRootProps:Q,getInputProps:Z,isDragActive:J}=(0,x.uI)({onDrop:B,accept:{"image/svg+xml":[]},multiple:!1,noClick:!0});return(0,o.jsxs)("div",{...Q({className:"h-screen w-screen flex flex-row"}),children:[(0,o.jsx)(h(),{children:(0,o.jsx)("title",{children:"Spot Color Separation"})}),(0,o.jsx)("input",{...Z()}),(0,o.jsx)(G,{show:J}),(0,o.jsxs)("div",{className:"w-72 h-full p-2 overflow-y-auto flex flex-col flex-shrink-0 justify-between",children:[(0,o.jsxs)("div",{className:"space-y-2 flex-grow flex flex-col",children:[(0,o.jsx)("h1",{className:"font-bold text-xl text-center",children:"Spot Color Separator"}),(0,o.jsx)(N,{onFile:q,loading:null===p}),O]}),(0,o.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,o.jsx)(n.u,{label:"show help",children:(0,o.jsx)(r.hU,{"aria-label":"show help information",icon:(0,o.jsx)(g.DAO,{}),isDisabled:!p,onClick:s})}),(0,o.jsx)("a",{href:"https://github.com/hafaio/color-separation",target:"_blank",rel:"noreferrer",children:(0,o.jsx)(r.hU,{"aria-label":"view source on github",icon:(0,o.jsx)(g.hJX,{})})})]})]}),(0,o.jsx)("div",{className:"h-full w-full overflow-auto",children:$})]})}},3281:function(){},1805:function(){}},function(e){e.O(0,[219,312,774,888,179],function(){return e(e.s=3074)}),_N_E=e.O()}]);