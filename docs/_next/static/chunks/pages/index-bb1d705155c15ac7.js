(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3074:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(4077)}])},4077:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return P}});var o=t(1874),r=t(2816),a=t(3843),n=t(1908),s=t(5998),i=t(5530),c=t(1541),d=t(2160),f=t(9611),u=t.n(f),h=t(9953),p=t(4085);function m(e,l,t){let o=e.get(l);if(void 0!==o)return o;{let r=t(l);return e.set(l,r),r}}function x(e){let l;if(l=e.match(/^#([0-9a-fA-F]{6})$/)){let[,t]=l;return"#".concat(t.toLowerCase())}if(l=e.match(/^#([0-9a-fA-F]{3})$/)){let[,[o,r,a]]=l;return"#".concat(o).concat(o).concat(r).concat(r).concat(a).concat(a).toLowerCase()}if(l=e.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/)){let[,n,s,i,c]=l;return g([n,s,i].map(e=>parseInt(e,16)/255),parseInt(c,16)/255)}if(l=e.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/)){let[,d,f,u]=l;return j([parseInt(d)/255,parseInt(f)/255,parseInt(u)/255])}if(l=e.match(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([-+\d.eE]+)\s*\)$/)){let[,h,p,m,x]=l;return g([h,p,m].map(e=>parseInt(e)/255),parseFloat(x))}throw Error("invalid color format: '".concat(e,"'"))}function g(e,l){return j(e.map(e=>(e-1)*l+1))}function j(e){let l=e.map(e=>Math.round(255*e).toString(16).padStart(2,"0")).join("");return"#".concat(l)}var b=t(6011),v=t(5630);function w(e){return[void 0,void 0,void 0].map((l,t)=>1-parseInt(e.slice(2*t+1,2*t+3),16)/255)}function C(e,l){let t=0;for(let[o,r]of e.entries())t+=r*l[o];return t}function y(e){let{onFile:l,loading:t=!1}=e,a=e=>{var t;let o=null===(t=e.target.files)||void 0===t?void 0:t[0];o&&l(o)},n=(0,h.useRef)(null),s=()=>{var e;null===(e=n.current)||void 0===e||e.click()};return(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{ref:n,type:"file",accept:"image/svg+xml",onChange:a,className:"hidden"}),(0,o.jsx)(r.zx,{className:"w-full",isLoading:t,onClick:s,leftIcon:(0,o.jsx)(p.Gq2,{}),children:"Upload"})]})}function k(e){let{color:l,name:t,active:r,toggleColor:n}=e,s=(0,h.useCallback)(()=>n(l),[l,n]);return(0,o.jsx)(a.u,{label:t,children:(0,o.jsx)("button",{className:"rounded-full bg-transparent transition-all m-1 focus:outline hover:scale-110",style:{width:"2rem",height:"2rem",borderWidth:r?"0.2rem":"1rem",borderColor:l,outlineColor:l},onClick:s})})}let S=[["#f15060","bright red"],["#ff48b0","fluorescent pink"],["#ffe800","yellow"],["#00a95c","green"],["#0078bf","blue"],["#000000","black"]],N=[["#00ffff","cyan"],["#ff00ff","magenta"],["#ffff00","yellow"],["#000000","black"]];function M(e){let{colors:l,setPallette:t,addColor:i,paperColor:c,setPaperColor:d}=e,f=e=>{let l=e.target.value;"none"===l?t([]):"riso"===l?t(S):"cmyk"===l&&t(N)};(0,h.useEffect)(()=>t(S),[t]);let[u,p]=(0,h.useState)(""),m=(0,h.useCallback)(e=>p(e.target.value),[p]),[x,g]=(0,h.useState)("#000000"),j=(0,h.useCallback)(e=>g(e.target.value),[g]),b=(0,h.useCallback)(e=>d(e.target.value),[d]),v=(0,h.useCallback)(()=>i(x,u),[x,u,i]),w=u&&!l.has(x),C=u?l.has(x)?"can only add unique colors":void 0:"must name added colors";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.BZ,{children:[(0,o.jsx)(n.II,{placeholder:"Color Name",value:u,onChange:m}),(0,o.jsx)(n.II,{type:"color",style:{borderRadius:0,borderLeft:0,width:"8rem"},value:x,onChange:j}),(0,o.jsx)(n.xW,{style:{padding:0},children:(0,o.jsx)(a.u,{label:C,children:(0,o.jsx)(r.zx,{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isDisabled:!w,onClick:v,children:"Add"})})})]}),(0,o.jsxs)(s.Ph,{placeholder:"Select Pallette",onChange:f,children:[(0,o.jsx)("option",{value:"none",children:"None"}),(0,o.jsx)("option",{value:"riso",children:"Risograph"}),(0,o.jsx)("option",{value:"cmyk",children:"CMYK"})]}),(0,o.jsxs)(n.BZ,{children:[(0,o.jsx)(n.Ui,{children:(0,o.jsx)(a.u,{label:"Set the printed paper color",children:"Paper Color"})}),(0,o.jsx)(n.II,{type:"color",value:c,onChange:b})]})]})}function I(e){let{colors:l,toggleColor:t}=e,r=[...l].map(e=>{let[l,[r,a]]=e;return(0,o.jsx)(k,{color:l,name:r,toggleColor:t,active:a},l)});return(0,o.jsx)("div",{className:"flex flex-wrap justify-center",children:r})}function E(e){let{children:l}=e;return(0,o.jsx)("h2",{className:"font-bold text-lg",children:l})}function F(e){let{colors:l,modifyColors:t,paperColor:n,setPaperColor:s,quadratic:c,toggleQuadratic:d,download:f,showRaw:u,setShowRaw:m,fit:x,toggleFit:g}=e,j=l.size?void 0:"must select at least one color to export",b=(0,h.useCallback)(()=>m(!0),[m]),v=(0,h.useCallback)(()=>m(!1),[m]),w=(0,h.useCallback)(e=>t({action:"toggle",color:e}),[t]),C=(0,h.useCallback)(e=>t({action:"set",colors:e}),[t]),y=(0,h.useCallback)((e,l)=>t({action:"add",color:e,name:l}),[t]),k=[...l.values()].some(e=>{let[,l]=e;return l});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.zx,{className:"w-full",isDisabled:!k,onMouseDown:b,onMouseUp:v,children:"Toggle Original"}),(0,o.jsx)(a.u,{label:j,children:(0,o.jsx)(r.zx,{className:"w-full",isDisabled:!k,onClick:f,leftIcon:(0,o.jsx)(p.ZJh,{}),children:"Export Separation"})}),(0,o.jsx)(E,{children:"Colors"}),(0,o.jsx)("p",{children:"Click a color to toggle its use in the separation"}),(0,o.jsx)(I,{colors:l,toggleColor:w}),(0,o.jsx)(E,{children:"Pallette"}),(0,o.jsx)("p",{children:"Add new colors or reset to a pallette"}),(0,o.jsx)(M,{setPallette:C,colors:l,addColor:y,paperColor:n,setPaperColor:s}),(0,o.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,o.jsx)("label",{htmlFor:"quadratic",children:(0,o.jsx)(E,{children:"Quadratic Loss"})}),(0,o.jsx)(i.r,{id:"quadratic",isChecked:c,onChange:d,colorScheme:"gray"})]}),(0,o.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,o.jsx)("label",{htmlFor:"image-fit",children:(0,o.jsx)(E,{children:"Fit Image"})}),(0,o.jsx)(i.r,{id:"image-fit",colorScheme:"gray",isChecked:x,onChange:g})]})]})}function _(e){let{closeable:l}=e,t=l?(0,o.jsx)("p",{className:"pt-4 pb-4",children:"Click the info button below to hide this information."}):null;return(0,o.jsxs)("div",{className:"flex flex-col justify-between flex-grow",children:[(0,o.jsxs)("div",{className:"space-y-1 flex-grow",children:[(0,o.jsx)("p",{children:"Separate an SVG into spot colors; useful for risograph printing. Currently this assumes a naive color model, and printing on white."}),(0,o.jsxs)("ol",{className:"list-decimal ml-4",children:[(0,o.jsxs)("li",{children:["Upload your svg above. Your SVG can contain opacity, but"," ",(0,o.jsx)("span",{className:"italic",children:"must not"})," contain overlapping elements, embedded bitmaps, or gradients."]}),(0,o.jsx)("li",{children:"Customize your color pallette by adding colors available."}),(0,o.jsx)("li",{children:"Select different colors and losses to check our your decomposition."}),(0,o.jsx)("li",{children:"Click export to download an individual SVG for each layer."})]})]}),t]})}function P(){let[e,l]=(0,h.useReducer)(e=>!e,!0),[t,n]=(0,h.useState)(!1),[s,i]=(0,h.useState)(!1),f=(0,h.useCallback)(()=>i(!s),[s,i]),g=(0,c.pm)(),[k,S]=(0,h.useState)(),[N,M]=(0,h.useState)(),[I,E]=(0,h.useReducer)((e,l)=>{if("set"===l.action)return new Map(l.colors.map(e=>{let[l,t]=e;return[l,[t,!1]]}));if("add"===l.action){let t=new Map(e);return t.set(l.color,[l.name,!1]),t}{let o=new Map(e),[r,a]=o.get(l.color);return o.set(l.color,[r,!a]),o}},new Map),[P,z]=(0,h.useState)("#ffffff"),[[R,A],L]=(0,h.useState)([void 0,new Map]),[G,U]=(0,h.useReducer)(e=>!e,!0);(0,h.useEffect)(()=>{if(N){if([...I.values()].some(e=>{let[,l]=e;return l})){let e=[];for(let[l,[,t]]of I)t&&e.push(l);let o=new Map;for(let[r,{fill:a,stroke:n}]of N.elems){let{opacities:s,color:i}=function(e,l){let{quadratic:t=!0,paper:o="#ffffff"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=w(e),a=w(o),n=r.map((e,l)=>e-a[l]),s=l.map(w),{error:i,opacities:c}=t?function(e,l){let t=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),o=[,...l.map((e,o)=>[,...l.map((l,r)=>C(e,l)+(o===r?t[o]:0))])],r=[,...l.map(l=>C(l,e))],a=[,...l.map((e,t)=>[,...l.map((e,l)=>t===l?1:0),...l.map((e,l)=>t===l?-1:0)])],n=[,...l.map(()=>0),...l.map(()=>-1)],{solution:[,...s],value:[,i],message:c,...d}=(0,v.solveQP)(o,r,a,n),f=C(e,e),u=s.reduce((e,l)=>e+1e-4*l*l,0);if(!c)return{error:Math.sqrt(Math.max(2*i+f-u,0))/3,opacities:s.map(e=>Math.min(Math.max(0,e),1))};throw Error(c)}(n,s):function(e,l){let t=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),o={},r={};for(let[a,n]of t.entries())r["mix ".concat(a)]={error:n};for(let[s,i]of e.entries()){let c="up ".concat(s);o[c]={max:i};let d="dn ".concat(s);o[d]={min:i};let f="slack ".concat(s);for(let[u,h]of(r[f]={error:1,[c]:-1,[d]:1},l.entries())){let p=h[s],m="mix ".concat(u);r[m][c]=p,r[m][d]=p}}let{result:x,feasible:g,bounded:j,...v}=b.Solve.call({},{optimize:"error",opType:"min",constraints:o,variables:r});if(g&&j){var w;let C=l.map((e,l)=>null!==(w=v["mix ".concat(l)])&&void 0!==w?w:0),y=C.reduce((e,l,o)=>e+t[o]*l,0);return{error:(x-y)/3,opacities:C}}throw Error("couldn't find bounded feasible solution")}(n,s),d=[...a];for(let[f,u]of s.entries()){let h=c[f];for(let[p,m]of u.entries())d[p]+=m*h}return{error:i,opacities:c,color:j(d.map(e=>1-e))}}(r,e,{quadratic:G,paper:P});for(let c of a)c.style.fill=i;for(let d of n)d.style.stroke=i;o.set(r,s)}let f=new XMLSerializer,u=f.serializeToString(N.doc);L(["data:image/svg+xml,".concat(encodeURIComponent(u)),o])}else{var h;for(let[p,{fill:m,stroke:x}]of null!==(h=null==N?void 0:N.elems)&&void 0!==h?h:[]){for(let g of m)g.style.fill=p;for(let y of x)y.style.stroke=p}L([void 0,new Map])}}else L([void 0,new Map])},[I,G,N,L,P]);let q=(0,h.useCallback)(()=>{if(N&&A.size&&k){let e=k.slice(0,k.lastIndexOf("."))||k,l=new XMLSerializer,t=0;for(let[o,[r,a]]of I)if(a){for(let[n,{fill:s,stroke:i}]of N.elems){let c=A.get(n)[t],f=Math.round(255*(1-c)).toString(16),u="#".concat(f).concat(f).concat(f);for(let h of s)h.style.fill=u;for(let p of i)p.style.stroke=u}let m=l.serializeToString(N.doc),x=new Blob([m],{type:"image/svg+xml"});(0,d.saveAs)(x,"".concat(e,"_").concat(r.replace(" ","_"),".svg")),t++}}},[N,A,I,k]),D=(0,h.useCallback)(async e=>{let l,t;S(e.name),M(null),i(!1);try{let o=await e.text(),r=new DOMParser,a=r.parseFromString(o,"image/svg+xml");(t=document.createElement("div")).style.display="none";let n=t.attachShadow({mode:"open"});for(let s of a.children)n.appendChild(s);document.documentElement.appendChild(t);let c=new Map;for(let d of n.querySelectorAll("*"))if(d instanceof SVGElement){let{fill:f,stroke:u}=getComputedStyle(d);if(f&&"none"!==f)try{let h=x(f),p=m(c,h,()=>({fill:[],stroke:[]})).fill;p.push(d)}catch(j){console.error("problem parsing color",j),l="Problem parsing colors in SVG",d.style.fill="none"}if(u&&"none"!==u)try{let b=x(u),v=m(c,b,()=>({fill:[],stroke:[]})).stroke;v.push(d)}catch(w){console.error("problem parsing color",w),l="Problem parsing colors in SVG",d.style.stroke="none"}}for(let C of n.children)a.appendChild(C);M({raw:"data:image/svg+xml,".concat(encodeURIComponent(o)),doc:a,elems:c})}catch(y){console.error(y),l="Problem loading SVG",M(void 0)}finally{try{t&&document.documentElement.removeChild(t)}catch(k){}}l&&g({title:l,status:"error",position:"bottom-left"})},[M,S,i,g]),T=N&&!s?(0,o.jsx)(F,{colors:I,modifyColors:E,paperColor:P,setPaperColor:z,quadratic:G,toggleQuadratic:U,download:q,showRaw:t,setShowRaw:n,fit:e,toggleFit:l}):(0,o.jsx)(_,{closeable:!!N}),V=t?null==N?void 0:N.raw:null!=R?R:null==N?void 0:N.raw,O=V?(0,o.jsx)("img",{src:V,alt:"rendered separation",className:"h-full w-full ".concat(e?"object-contain":"object-cover")}):null;return(0,o.jsxs)("div",{className:"h-screen w-screen flex flex-row",children:[(0,o.jsx)(u(),{children:(0,o.jsx)("title",{children:"Spot Color Separation"})}),(0,o.jsxs)("div",{className:"w-72 h-full p-2 overflow-y-auto flex flex-col flex-shrink-0 justify-between",children:[(0,o.jsxs)("div",{className:"space-y-2 flex-grow flex flex-col",children:[(0,o.jsx)("h1",{className:"font-bold text-xl text-center",children:"Spot Color Separator"}),(0,o.jsx)(y,{onFile:D,loading:null===N}),T]}),(0,o.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,o.jsx)(a.u,{label:"show help",children:(0,o.jsx)(r.hU,{"aria-label":"show help information",icon:(0,o.jsx)(p.DAO,{}),isDisabled:!N,onClick:f})}),(0,o.jsx)("a",{href:"https://github.com/hafaio/color-separation",target:"_blank",rel:"noreferrer",children:(0,o.jsx)(r.hU,{"aria-label":"view source on github",icon:(0,o.jsx)(p.hJX,{})})})]})]}),(0,o.jsx)("div",{className:"h-full w-full overflow-auto",children:O})]})}},3281:function(){},1805:function(){}},function(e){e.O(0,[219,591,774,888,179],function(){return e(e.s=3074)}),_N_E=e.O()}]);