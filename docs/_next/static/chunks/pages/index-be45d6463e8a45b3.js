(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{4683:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(8766)}])},8766:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return M}});var o=t(1874),a=t(3671),r=t(2936),n=t(768),s=t(1523),i=t(9779),c=t(2160),d=t(9953),u=t(7376);function f(e,l){return h(e.map(e=>(e-1)*l+1))}function h(e){let l=e.map(e=>Math.round(255*e).toString(16).padStart(2,"0")).join("");return"#".concat(l)}var m=t(6011),x=t(5630);function p(e){return[void 0,void 0,void 0].map((l,t)=>1-parseInt(e.slice(2*t+1,2*t+3),16)/255)}function g(e,l){let t=0;for(let[o,a]of e.entries())t+=a*l[o];return t}function j(e){let{onFile:l,loading:t=!1}=e,r=e=>{var t;let o=null===(t=e.target.files)||void 0===t?void 0:t[0];o&&l(o)},n=(0,d.useRef)(null),s=()=>{var e;null===(e=n.current)||void 0===e||e.click()};return(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{ref:n,type:"file",accept:"image/svg+xml",onChange:r,className:"hidden"}),(0,o.jsx)(a.zx,{className:"w-full",isLoading:t,onClick:s,leftIcon:(0,o.jsx)(u.Gq2,{}),children:"Upload"})]})}function v(e){let{color:l,name:t,active:a,toggleColor:n}=e,s=(0,d.useCallback)(()=>n(l),[l,n]);return(0,o.jsx)(r.u,{label:t,children:(0,o.jsx)("button",{className:"rounded-full bg-transparent transition-all m-1 focus:outline hover:scale-110",style:{width:"2rem",height:"2rem",borderWidth:a?"0.2rem":"1rem",borderColor:l,outlineColor:l},onClick:s})})}let b=[["#f15060","bright red"],["#ff48b0","fluorescent pink"],["#ffe800","yellow"],["#00a95c","green"],["#0078bf","blue"],["#000000","black"]],w=[["#00ffff","cyan"],["#ff00ff","magenta"],["#ffff00","yellow"],["#000000","black"]];function C(e){let{colors:l,setPallette:t,addColor:i}=e,c=e=>{let l=e.target.value;"none"===l?t([]):"riso"===l?t(b):"cmyk"===l&&t(w)};(0,d.useEffect)(()=>t(b),[t]);let[u,f]=(0,d.useState)(""),h=(0,d.useCallback)(e=>f(e.target.value),[f]),[m,x]=(0,d.useState)("#000000"),p=(0,d.useCallback)(e=>x(e.target.value),[x]),g=(0,d.useCallback)(()=>i(m,u),[m,u,i]),j=u&&!l.has(m),v=u?l.has(m)?"can only add unique colors":void 0:"must name added colors";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.BZ,{children:[(0,o.jsx)(n.II,{placeholder:"Color Name",value:u,onChange:h}),(0,o.jsx)(n.II,{type:"color",style:{borderRadius:0,borderLeft:0,width:"8rem"},value:m,onChange:p}),(0,o.jsx)(n.xW,{style:{padding:0},children:(0,o.jsx)(r.u,{label:v,children:(0,o.jsx)(a.zx,{style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isDisabled:!j,onClick:g,children:"Add"})})})]}),(0,o.jsxs)(s.Ph,{placeholder:"Select Pallette",onChange:c,children:[(0,o.jsx)("option",{value:"none",children:"None"}),(0,o.jsx)("option",{value:"riso",children:"Risograph"}),(0,o.jsx)("option",{value:"cmyk",children:"CMYK"})]})]})}function y(e){let{colors:l,toggleColor:t}=e,a=[...l].map(e=>{let[l,[a,r]]=e;return(0,o.jsx)(v,{color:l,name:a,toggleColor:t,active:r},l)});return(0,o.jsx)("div",{className:"flex flex-wrap justify-center",children:a})}function k(e){let{children:l}=e;return(0,o.jsx)("h2",{className:"font-bold text-lg",children:l})}function N(e){let{colors:l,modifyColors:t,quadratic:n,toggleQuadratic:s,download:c,showRaw:f,setShowRaw:h,fit:m,toggleFit:x}=e,p=l.size?void 0:"must select at least one color to export",g=(0,d.useCallback)(()=>h(!0),[h]),j=(0,d.useCallback)(()=>h(!1),[h]),v=(0,d.useCallback)(e=>t({action:"toggle",color:e}),[t]),b=(0,d.useCallback)(e=>t({action:"set",colors:e}),[t]),w=(0,d.useCallback)((e,l)=>t({action:"add",color:e,name:l}),[t]),N=[...l.values()].some(e=>{let[,l]=e;return l});return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.zx,{className:"w-full",isDisabled:!N,onMouseDown:g,onMouseUp:j,children:"Toggle Original"}),(0,o.jsx)(r.u,{label:p,children:(0,o.jsx)(a.zx,{className:"w-full",isDisabled:!N,onClick:c,leftIcon:(0,o.jsx)(u.ZJh,{}),children:"Export Separation"})}),(0,o.jsx)(k,{children:"Colors"}),(0,o.jsx)("p",{children:"Click a color to toggle its use in the separation"}),(0,o.jsx)(y,{colors:l,toggleColor:v}),(0,o.jsx)(k,{children:"Pallette"}),(0,o.jsx)("p",{children:"Add new colors or reset to a pallette"}),(0,o.jsx)(C,{setPallette:b,addColor:w,colors:l}),(0,o.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,o.jsx)("label",{htmlFor:"quadratic",children:(0,o.jsx)(k,{children:"Quadratic Loss"})}),(0,o.jsx)(i.r,{id:"quadratic",isChecked:n,onChange:s,colorScheme:"gray"})]}),(0,o.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,o.jsx)("label",{htmlFor:"image-fit",children:(0,o.jsx)(k,{children:"Fit Image"})}),(0,o.jsx)(i.r,{id:"image-fit",colorScheme:"gray",isChecked:m,onChange:x})]})]})}function S(e){let{closeable:l}=e,t=l?(0,o.jsx)("p",{className:"pt-4 pb-4",children:"Click the info button below to hide this information."}):null;return(0,o.jsxs)("div",{className:"flex flex-col justify-between flex-grow",children:[(0,o.jsxs)("div",{className:"space-y-1 flex-grow",children:[(0,o.jsx)("p",{children:"Separate an SVG into spot colors; useful for risograph printing. Currently this assumes a naive color model, and printing on white."}),(0,o.jsxs)("ol",{className:"list-decimal ml-4",children:[(0,o.jsxs)("li",{children:["Upload your svg above. Your SVG can contain opacity, but"," ",(0,o.jsx)("span",{className:"italic",children:"must not"})," contain overlapping elements, embedded bitmaps, strokes, or gradients."]}),(0,o.jsx)("li",{children:"Customize your color pallette by adding colors available."}),(0,o.jsx)("li",{children:"Select different colors and losses to check our your decomposition."}),(0,o.jsx)("li",{children:"Click export to download an individual SVG for each layer."})]})]}),t]})}function M(){let[e,l]=(0,d.useReducer)(e=>!e,!0),[t,n]=(0,d.useState)(!1),[s,i]=(0,d.useState)(!1),v=(0,d.useCallback)(()=>i(!s),[s,i]),[b,w]=(0,d.useState)(),[C,y]=(0,d.useState)(),[k,M]=(0,d.useReducer)((e,l)=>{if("set"===l.action)return new Map(l.colors.map(e=>{let[l,t]=e;return[l,[t,!1]]}));if("add"===l.action){let t=new Map(e);return t.set(l.color,[l.name,!1]),t}{let o=new Map(e),[a,r]=o.get(l.color);return o.set(l.color,[a,!r]),o}},new Map),[[I,F],_]=(0,d.useState)([void 0,new Map]),[E,z]=(0,d.useReducer)(e=>!e,!0);(0,d.useEffect)(()=>{if(C){if([...k.values()].some(e=>{let[,l]=e;return l})){let e=[];for(let[l,[,t]]of k)t&&e.push(l);let o=new Map;for(let[a,r]of C.elems){let{opacities:n,color:s}=function(e,l){let{quadratic:t=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=p(e),a=l.map(p),{error:r,opacities:n}=t?function(e,l){let t=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),o=[,...l.map((e,o)=>[,...l.map((l,a)=>g(e,l)+(o===a?t[o]:0))])],a=[,...l.map(l=>g(l,e))],r=[,...l.map((e,t)=>[,...l.map((e,l)=>t===l?1:0),...l.map((e,l)=>t===l?-1:0)])],n=[,...l.map(()=>0),...l.map(()=>-1)],{solution:[,...s],value:[,i],message:c,...d}=(0,x.solveQP)(o,a,r,n),u=g(e,e),f=s.reduce((e,l)=>e+1e-4*l*l,0);if(!c)return{error:Math.sqrt(Math.max(2*i+u-f,0))/3,opacities:s.map(e=>Math.min(Math.max(0,e),1))};throw Error(c)}(o,a):function(e,l){let t=l.map(e=>1e-4*e.reduce((e,l)=>e+(1-l)/3,0)),o={},a={};for(let[r,n]of t.entries())a["mix ".concat(r)]={error:n};for(let[s,i]of e.entries()){let c="up ".concat(s);o[c]={max:i};let d="dn ".concat(s);o[d]={min:i};let u="slack ".concat(s);for(let[f,h]of(a[u]={error:1,[c]:-1,[d]:1},l.entries())){let x=h[s],p="mix ".concat(f);a[p][c]=x,a[p][d]=x}}let{result:g,feasible:j,bounded:v,...b}=m.Solve.call({},{optimize:"error",opType:"min",constraints:o,variables:a});if(j&&v){var w;let C=l.map((e,l)=>null!==(w=b["mix ".concat(l)])&&void 0!==w?w:0),y=C.reduce((e,l,o)=>e+t[o]*l,0);return{error:(g-y)/3,opacities:C}}throw Error("couldn't find bounded feasible solution")}(o,a),s=[0,0,0];for(let[i,c]of a.entries()){let d=n[i];for(let[u,f]of c.entries())s[u]+=f*d}return{error:r,opacities:n,color:h(s.map(e=>1-e))}}(a,e,{quadratic:E});for(let i of r)i.style.fill=s;o.set(a,n)}let c=new XMLSerializer,d=c.serializeToString(C.doc);_(["data:image/svg+xml,".concat(encodeURIComponent(d)),o])}else{var u;for(let[f,j]of null!==(u=null==C?void 0:C.elems)&&void 0!==u?u:[])for(let v of j)v.style.fill=f;_([void 0,new Map])}}else _([void 0,new Map])},[k,E,C,_]);let R=(0,d.useCallback)(()=>{if(C&&F.size&&b){let e=b.slice(0,b.lastIndexOf("."))||b,l=new XMLSerializer,t=0;for(let[o,[a,r]]of k)if(r){for(let[n,s]of C.elems){let i=F.get(n)[t],d="rgba(0,0,0,".concat(i,")");for(let u of s)u.style.fill=d}let f=l.serializeToString(C.doc),h=new Blob([f],{type:"image/svg+xml"});(0,c.saveAs)(h,"".concat(e,"_").concat(a.replace(" ","_"),".svg")),t++}}},[C,F,k,b]),A=async e=>{w(e.name),y(null),i(!1);let l=await e.text(),t=new DOMParser,o=t.parseFromString(l,"image/svg+xml"),a=new Map;for(let r of o.all)if(r instanceof SVGElement){let n=r.style.fill;if(n){let s=function(e){let l;if(l=e.match(/^#([0-9a-fA-F]{6})$/)){let[,t]=l;return"#".concat(t.toLowerCase())}if(l=e.match(/^#([0-9a-fA-F]{3})$/)){let[,[o,a,r]]=l;return"#".concat(o).concat(o).concat(a).concat(a).concat(r).concat(r).toLowerCase()}if(l=e.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/)){let[,n,s,i,c]=l;return f([n,s,i].map(e=>parseInt(e,16)/255),parseInt(c,16)/255)}if(l=e.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/)){let[,d,u,m]=l;return h([parseInt(d)/255,parseInt(u)/255,parseInt(m)/255])}if(l=e.match(/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([-+\d.eE]+)\s*\)$/)){let[,x,p,g,j]=l;return f([x,p,g].map(e=>parseInt(e)/255),parseFloat(j))}throw Error("invalid color format: '".concat(e,"'"))}(n),c=a.get(s);c?c.push(r):a.set(s,[r])}}y({raw:"data:image/svg+xml,".concat(encodeURIComponent(l)),doc:o,elems:a})},L=C&&!s?(0,o.jsx)(N,{colors:k,modifyColors:M,quadratic:E,toggleQuadratic:z,download:R,showRaw:t,setShowRaw:n,fit:e,toggleFit:l}):(0,o.jsx)(S,{closeable:!!C}),P=t?null==C?void 0:C.raw:null!=I?I:null==C?void 0:C.raw,D=P?(0,o.jsx)("img",{src:P,alt:"rendered separation",className:"h-full w-full ".concat(e?"object-contain":"object-cover")}):null;return(0,o.jsxs)("div",{className:"h-screen w-screen flex flex-row",children:[(0,o.jsxs)("div",{className:"w-72 h-full p-2 overflow-y-auto flex flex-col flex-shrink-0 justify-between",children:[(0,o.jsxs)("div",{className:"space-y-2 flex-grow flex flex-col",children:[(0,o.jsx)("h1",{className:"font-bold text-xl text-center",children:"Spot Color Separator"}),(0,o.jsx)(j,{onFile:A,loading:null===C}),L]}),(0,o.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,o.jsx)(r.u,{label:"show help",children:(0,o.jsx)(a.hU,{"aria-label":"show help information",icon:(0,o.jsx)(u.DAO,{}),isDisabled:!C,onClick:v})}),(0,o.jsx)("a",{href:"https://github.com/hafaio/color-separation",target:"_blank",rel:"noreferrer",children:(0,o.jsx)(a.hU,{"aria-label":"view source on github",icon:(0,o.jsx)(u.hJX,{})})})]})]}),(0,o.jsx)("div",{className:"h-full w-full overflow-auto",children:D})]})}},3281:function(){},1805:function(){}},function(e){e.O(0,[477,31,774,888,179],function(){return e(e.s=4683)}),_N_E=e.O()}]);